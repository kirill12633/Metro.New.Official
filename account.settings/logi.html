<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö - –ú–µ—Ç—Ä–æ New</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <style>
        .database-auth {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem;
        }

        .database-panel {
            display: none;
            padding: 2rem 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .user-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
            border-left: 4px solid var(--primary);
            margin-bottom: 1rem;
        }

        .user-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .user-actions {
            display: flex;
            gap: 0.5rem;
        }

        .login-history {
            background: #f8f9fa;
            border-radius: var(--radius-md);
            padding: 1rem;
            margin-top: 1rem;
        }

        .login-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            border-bottom: 1px solid #dee2e6;
        }

        .login-item:last-child {
            border-bottom: none;
        }

        .search-box {
            background: white;
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-md);
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #dee2e6;
        }
    </style>
</head>
<body>
    <!-- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö -->
    <div class="database-auth" id="databaseAuth">
        <div class="card" style="max-width: 400px; text-align: center;">
            <h1><i class="fas fa-database"></i> –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</h1>
            <p>–î–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–Ω—ã–º –ª–æ–≥–∞–º –∏ –¥–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
            
            <form id="databaseLoginForm">
                <div class="form-group">
                    <div class="input-with-icon">
                        <i class="fas fa-user input-icon"></i>
                        <input type="text" class="form-input" id="dbUsername" placeholder="–õ–æ–≥–∏–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="input-with-icon">
                        <i class="fas fa-lock input-icon"></i>
                        <input type="password" class="form-input" id="dbPassword" placeholder="–ü–∞—Ä–æ–ª—å" required>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary w-100">
                    –í–æ–π—Ç–∏ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
                </button>
            </form>
            
            <div style="margin-top: 1rem; color: var(--gray); font-size: 0.8rem;">
                <i class="fas fa-shield-alt"></i> –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
            </div>

            <!-- –°–ì–ï–ù–ï–†–ò–†–û–í–ê–ù–ù–´–ï –î–ê–ù–ù–´–ï –î–õ–Ø –í–•–û–î–ê -->
            <div style="margin-top: 1.5rem; padding: 1rem; background: var(--info-light); border-radius: 8px; border: 1px solid var(--info);">
                <h4 style="color: var(--info); margin-bottom: 0.5rem;"><i class="fas fa-key"></i> –î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞:</h4>
                <div style="text-align: left; font-size: 0.9rem;">
                    <p><strong>–õ–æ–≥–∏–Ω:</strong> <code>metro_admin_2025</code></p>
                    <p><strong>–ü–∞—Ä–æ–ª—å:</strong> <code>M3tr0_N3w_S3cur3_2025!</code></p>
                    <p><strong>–£—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø–∞:</strong> –ü–æ–ª–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</p>
                </div>
                <button type="button" class="btn btn-outline btn-sm w-100 mt-2" onclick="fillDBCredentials()">
                    <i class="fas fa-fingerprint"></i> –ó–∞–ø–æ–ª–Ω–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
                </button>
            </div>
        </div>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö -->
    <div class="database-panel" id="databasePanel">
        <div class="container">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
            <div class="card">
                <div class="card-header">
                    <h1><i class="fas fa-database"></i> –°–∏—Å—Ç–µ–º–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</h1>
                    <button class="btn btn-secondary" onclick="refreshDatabase()">
                        <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                </div>
                
                <div class="stats-grid">
                    <div class="card text-center">
                        <span class="stat-number" id="totalUsers">0</span>
                        <span class="stat-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</span>
                    </div>
                    <div class="card text-center">
                        <span class="stat-number" id="activeUsers">0</span>
                        <span class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö</span>
                    </div>
                    <div class="card text-center">
                        <span class="stat-number" id="verifiedUsers">0</span>
                        <span class="stat-label">–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–æ</span>
                    </div>
                    <div class="card text-center">
                        <span class="stat-number" id="totalLogins">0</span>
                        <span class="stat-label">–í—Å–µ–≥–æ –≤—Ö–æ–¥–æ–≤</span>
                    </div>
                </div>
            </div>

            <!-- –ü–æ–∏—Å–∫ -->
            <div class="search-box">
                <div class="input-with-icon">
                    <i class="fas fa-search input-icon"></i>
                    <input type="text" class="form-input" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –∏–º–µ–Ω–∏, email –∏–ª–∏ ID...">
                </div>
            </div>

            <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-users"></i> –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
                    <button class="btn btn-success" onclick="exportAllData()">
                        <i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
                    </button>
                </div>
                
                <div id="usersList">
                    <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω —á–µ—Ä–µ–∑ JS -->
                </div>
            </div>

            <!-- –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏ -->
            <div class="card mt-4">
                <div class="card-header">
                    <h2><i class="fas fa-history"></i> –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏</h2>
                    <button class="btn btn-warning" onclick="clearAllLogs()">
                        <i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ª–æ–≥–∏
                    </button>
                </div>
                
                <div id="systemLogs">
                    <!-- –õ–æ–≥–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                </div>
            </div>

            <!-- –î–µ–π—Å—Ç–≤–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
            <div class="card mt-4">
                <div class="card-header">
                    <h2><i class="fas fa-tools"></i> –°–∏—Å—Ç–µ–º–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
                </div>
                
                <div class="grid grid-3">
                    <button class="btn btn-info" onclick="showSystemInfo()">
                        <i class="fas fa-info-circle"></i> –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ
                    </button>
                    <button class="btn btn-warning" onclick="backupDatabase()">
                        <i class="fas fa-save"></i> –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø
                    </button>
                    <button class="btn btn-danger" onclick="dbLogout()">
                        <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="assets/js/main.js"></script>
    <script>
        // –î–ê–ù–ù–´–ï –î–õ–Ø –í–•–û–î–ê –í –ë–ê–ó–£ –î–ê–ù–ù–´–•
        const DATABASE_CREDENTIALS = {
            username: 'metro_admin_2025',
            password: 'M3tr0_N3w_S3cur3_2025!'
        };

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        document.addEventListener('DOMContentLoaded', function() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            const isDbAuth = localStorage.getItem('db_auth');
            if (isDbAuth) {
                showDatabasePanel();
            }
        });

        // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—Ö–æ–¥–∞
        function fillDBCredentials() {
            document.getElementById('dbUsername').value = DATABASE_CREDENTIALS.username;
            document.getElementById('dbPassword').value = DATABASE_CREDENTIALS.password;
            metroSystem.showNotification('–î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã!', 'success');
        }

        // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
        document.getElementById('databaseLoginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('dbUsername').value;
            const password = document.getElementById('dbPassword').value;
            
            if (username === DATABASE_CREDENTIALS.username && password === DATABASE_CREDENTIALS.password) {
                localStorage.setItem('db_auth', 'true');
                showDatabasePanel();
                metroSystem.showNotification('–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö!', 'success');
                
                // –õ–æ–≥–∏—Ä—É–µ–º –≤—Ö–æ–¥ –≤ Discord
                logSystemAction('DATABASE_ACCESS', `–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –≤–æ—à–µ–ª –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö: ${username}`);
            } else {
                metroSystem.showNotification('–ù–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ!', 'error');
                
                // –õ–æ–≥–∏—Ä—É–µ–º –ø–æ–ø—ã—Ç–∫—É –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
                logSystemAction('UNAUTHORIZED_ACCESS', `–ü–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö: ${username}`);
            }
        });

        function showDatabasePanel() {
            document.getElementById('databaseAuth').style.display = 'none';
            document.getElementById('databasePanel').style.display = 'block';
            loadDatabaseData();
        }

        function loadDatabaseData() {
            loadUsersList();
            loadSystemLogs();
            updateStats();
        }

        function loadUsersList() {
            const usersContainer = document.getElementById('usersList');
            const allUsers = getAllUsers();
            
            if (allUsers.length === 0) {
                usersContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users-slash"></i>
                        <h3>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö</h3>
                        <p>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—É—Å—Ç–∞</p>
                    </div>
                `;
                return;
            }
            
            usersContainer.innerHTML = allUsers.map(user => `
                <div class="user-card">
                    <div class="user-header">
                        <div>
                            <h3>${user.username || '–ë–µ–∑ –∏–º–µ–Ω–∏'}</h3>
                            <p style="color: var(--gray); font-size: 0.9rem;">
                                ${user.email || 'Email –Ω–µ —É–∫–∞–∑–∞–Ω'} 
                                ${user.role === 'administrator' ? '‚Ä¢ üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : ''}
                                ${user.verified ? '‚Ä¢ ‚úÖ –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω' : '‚Ä¢ ‚ùå –ù–µ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω'}
                            </p>
                        </div>
                        <div class="user-actions">
                            <button class="btn btn-sm btn-outline" onclick="viewUserDetails('${user.username}')">
                                <i class="fas fa-eye"></i> –ü—Ä–æ—Å–º–æ—Ç—Ä
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteUser('${user.username}')">
                                <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; font-size: 0.9rem;">
                        <div>
                            <strong>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</strong><br>
                            ${user.joinDate || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}
                        </div>
                        <div>
                            <strong>–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥:</strong><br>
                            ${user.loginTime || '–ù–∏–∫–æ–≥–¥–∞'}
                        </div>
                        <div>
                            <strong>–í—Å–µ–≥–æ –≤—Ö–æ–¥–æ–≤:</strong><br>
                            ${user.loginCount || 0}
                        </div>
                        <div>
                            <strong>–°—Ç–∞—Ç—É—Å:</strong><br>
                            ${user.verified ? '‚úÖ –ê–∫—Ç–∏–≤–µ–Ω' : '‚ö†Ô∏è –ù–µ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω'}
                        </div>
                    </div>
                    
                    ${user.loginHistory && user.loginHistory.length > 0 ? `
                        <div class="login-history">
                            <strong>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –≤—Ö–æ–¥—ã:</strong>
                            ${user.loginHistory.slice(0, 3).map(login => `
                                <div class="login-item">
                                    <div>
                                        <span style="font-weight: 500;">${login.time}</span>
                                        <div style="color: var(--gray); font-size: 0.8rem;">
                                            IP: ${login.ip} ‚Ä¢ ${login.device}
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function loadSystemLogs() {
            const logsContainer = document.getElementById('systemLogs');
            const allUsers = getAllUsers();
            let allLogs = [];
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –ª–æ–≥–∏ –∏–∑ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            allUsers.forEach(user => {
                if (user.loginHistory) {
                    user.loginHistory.forEach(login => {
                        allLogs.push({
                            type: 'USER_LOGIN',
                            user: user.username,
                            time: login.time,
                            ip: login.ip,
                            device: login.device,
                            message: `–í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${user.username}`
                        });
                    });
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –ª–æ–≥–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
                if (user.joinDate) {
                    allLogs.push({
                        type: 'USER_REGISTER',
                        user: user.username,
                        time: user.joinDate,
                        ip: '–°–∏—Å—Ç–µ–º–∞',
                        device: '–°–∏—Å—Ç–µ–º–∞',
                        message: `–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${user.username}`
                    });
                }
            });
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
            allLogs.sort((a, b) => new Date(b.time) - new Date(a.time));
            
            if (allLogs.length === 0) {
                logsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-history"></i>
                        <h3>–ù–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ª–æ–≥–æ–≤</h3>
                        <p>–ò—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π –ø—É—Å—Ç–∞</p>
                    </div>
                `;
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 –∑–∞–ø–∏—Å–µ–π
            const recentLogs = allLogs.slice(0, 50);
            
            logsContainer.innerHTML = recentLogs.map(log => `
                <div class="login-item">
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                            <span style="font-weight: 500;">${log.message}</span>
                            <span class="badge ${log.type === 'USER_LOGIN' ? 'badge-success' : 'badge-info'}" style="font-size: 0.7rem;">
                                ${log.type === 'USER_LOGIN' ? '–í–•–û–î' : '–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø'}
                            </span>
                        </div>
                        <div style="color: var(--gray); font-size: 0.8rem;">
                            ${log.time} ‚Ä¢ IP: ${log.ip} ‚Ä¢ ${log.device}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getAllUsers() {
            const users = [];
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('metro_user_') || key === 'metro_user') {
                    try {
                        const userData = JSON.parse(localStorage.getItem(key));
                        users.push(userData);
                    } catch (e) {
                        console.error('Error parsing user data:', e);
                    }
                }
            }
            
            return users;
        }

        function updateStats() {
            const allUsers = getAllUsers();
            const activeUsers = allUsers.filter(user => user.loginTime);
            const verifiedUsers = allUsers.filter(user => user.verified);
            const totalLogins = allUsers.reduce((sum, user) => sum + (user.loginCount || 0), 0);
            
            document.getElementById('totalUsers').textContent = allUsers.length;
            document.getElementById('activeUsers').textContent = activeUsers.length;
            document.getElementById('verifiedUsers').textContent = verifiedUsers.length;
            document.getElementById('totalLogins').textContent = totalLogins;
        }

        // –î–µ–π—Å—Ç–≤–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
        function viewUserDetails(username) {
            const allUsers = getAllUsers();
            const user = allUsers.find(u => u.username === username);
            
            if (user) {
                const userInfo = `
–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ:

üë§ –ò–º—è: ${user.username}
üìß Email: ${user.email || '–ù–µ —É–∫–∞–∑–∞–Ω'}
üëë –†–æ–ª—å: ${user.role || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}
üìÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: ${user.joinDate || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}
‚è∞ –ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥: ${user.loginTime || '–ù–∏–∫–æ–≥–¥–∞'}
üî¢ –í—Å–µ–≥–æ –≤—Ö–æ–¥–æ–≤: ${user.loginCount || 0}
‚úÖ –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω: ${user.verified ? '–î–∞' : '–ù–µ—Ç'}
üìä –ò—Å—Ç–æ—Ä–∏—è –≤—Ö–æ–¥–æ–≤: ${user.loginHistory ? user.loginHistory.length : 0} –∑–∞–ø–∏—Å–µ–π
                `.trim();
                
                alert(userInfo);
            }
        }

        function deleteUser(username) {
            if (confirm(`–£–î–ê–õ–ò–¢–¨ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è "${username}"? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!`)) {
                localStorage.removeItem('metro_user_' + username);
                
                // –ï—Å–ª–∏ —ç—Ç–æ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —É–¥–∞–ª—è–µ–º –∏ –æ—Å–Ω–æ–≤–Ω—É—é –∑–∞–ø–∏—Å—å
                if (localStorage.getItem('metro_user')) {
                    const currentUser = JSON.parse(localStorage.getItem('metro_user'));
                    if (currentUser.username === username) {
                        localStorage.removeItem('metro_user');
                    }
                }
                
                metroSystem.showNotification(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å "${username}" —É–¥–∞–ª–µ–Ω!`, 'success');
                loadDatabaseData();
                
                // –õ–æ–≥–∏—Ä—É–µ–º –¥–µ–π—Å—Ç–≤–∏–µ
                logSystemAction('USER_DELETED', `–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —É–¥–∞–ª–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${username}`);
            }
        }

        // –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function refreshDatabase() {
            loadDatabaseData();
            metroSystem.showNotification('–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∞!', 'success');
        }

        function exportAllData() {
            const allUsers = getAllUsers();
            const dataStr = JSON.stringify(allUsers, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `metro_new_database_export_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            metroSystem.showNotification('–í—Å–µ –¥–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ JSON!', 'success');
            
            // –õ–æ–≥–∏—Ä—É–µ–º —ç–∫—Å–ø–æ—Ä—Ç
            logSystemAction('DATA_EXPORT', `–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${allUsers.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`);
        }

        function clearAllLogs() {
            if (confirm('–û–ß–ò–°–¢–ò–¢–¨ –í–°–ï –ª–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!')) {
                const allUsers = getAllUsers();
                allUsers.forEach(user => {
                    if (user.loginHistory) {
                        user.loginHistory = [];
                        localStorage.setItem('metro_user_' + user.username, JSON.stringify(user));
                    }
                });
                
                loadSystemLogs();
                metroSystem.showNotification('–í—Å–µ –ª–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã!', 'success');
                
                // –õ–æ–≥–∏—Ä—É–µ–º –æ—á–∏—Å—Ç–∫—É
                logSystemAction('LOGS_CLEARED', '–í—Å–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã');
            }
        }

        function showSystemInfo() {
            const allUsers = getAllUsers();
            const info = `
–°–ò–°–¢–ï–ú–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø:

üè¢ –ü—Ä–æ–µ–∫—Ç: Metro New
üìä –í–µ—Ä—Å–∏—è: 1.0
üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${allUsers.length}
‚úÖ –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–æ: ${allUsers.filter(u => u.verified).length}
üìà –ê–∫—Ç–∏–≤–Ω—ã—Ö: ${allUsers.filter(u => u.loginTime).length}
üîê –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤: ${allUsers.filter(u => u.role === 'administrator').length}
üíæ –•—Ä–∞–Ω–∏–ª–∏—â–µ: LocalStorage
üåê Webhook: –ê–∫—Ç–∏–≤–µ–Ω
            `.trim();
            
            alert(info);
        }

        function backupDatabase() {
            const allUsers = getAllUsers();
            const backupData = {
                timestamp: new Date().toISOString(),
                version: '1.0',
                totalUsers: allUsers.length,
                users: allUsers
            };
            
            const dataStr = JSON.stringify(backupData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `metro_new_backup_${new Date().toISOString().split('T')[0]}_${Date.now()}.json`;
            link.click();
            
            metroSystem.showNotification('–ë—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω!', 'success');
            
            // –õ–æ–≥–∏—Ä—É–µ–º –±—ç–∫–∞–ø
            logSystemAction('BACKUP_CREATED', `–°–æ–∑–¥–∞–Ω –±—ç–∫–∞–ø ${allUsers.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`);
        }

        function dbLogout() {
            if (confirm('–í—ã–π—Ç–∏ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö?')) {
                localStorage.removeItem('db_auth');
                window.location.reload();
            }
        }

        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –≤ Discord
        async function logSystemAction(action, message) {
            const discordData = {
                embeds: [{
                    title: "üìä –°–ò–°–¢–ï–ú–ù–û–ï –î–ï–ô–°–¢–í–ò–ï",
                    color: 0x17A2B8,
                    fields: [
                        {
                            name: "‚ö° –î–µ–π—Å—Ç–≤–∏–µ",
                            value: action,
                            inline: true
                        },
                        {
                            name: "üìù –°–æ–æ–±—â–µ–Ω–∏–µ",
                            value: message,
                            inline: true
                        },
                        {
                            name: "üë®‚Äçüíº –ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä",
                            value: "–°–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä",
                            inline: true
                        },
                        {
                            name: "üìÖ –í—Ä–µ–º—è",
                            value: new Date().toLocaleString(),
                            inline: true
                        }
                    ],
                    timestamp: new Date().toISOString(),
                    footer: {
                        text: "Metro New Database System"
                    }
                }]
            };

            await metroSystem.sendToDiscord(discordData);
        }

        // –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const allUsers = getAllUsers();
            
            if (searchTerm.trim() === '') {
                loadUsersList();
                return;
            }
            
            const filteredUsers = allUsers.filter(user => 
                user.username.toLowerCase().includes(searchTerm) ||
                (user.email && user.email.toLowerCase().includes(searchTerm)) ||
                (user.verificationId && user.verificationId.toLowerCase().includes(searchTerm))
            );
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
            const usersContainer = document.getElementById('usersList');
            
            if (filteredUsers.length === 0) {
                usersContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <h3>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                        <p>–ü–æ –∑–∞–ø—Ä–æ—Å—É "${searchTerm}" –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
                    </div>
                `;
                return;
            }
            
            usersContainer.innerHTML = filteredUsers.map(user => `
                <div class="user-card">
                    <div class="user-header">
                        <div>
                            <h3>${user.username}</h3>
                            <p style="color: var(--gray); font-size: 0.9rem;">${user.email || 'Email –Ω–µ —É–∫–∞–∑–∞–Ω'}</p>
                        </div>
                        <span class="badge badge-info">–ù–∞–π–¥–µ–Ω –ø–æ –∑–∞–ø—Ä–æ—Å—É</span>
                    </div>
                </div>
            `).join('');
        });
    </script>
</body>
</html>
