<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–æ–≤–æ—Å—Ç–∏ ‚Äî –ú–µ—Ç—Ä–æ New</title>
    
    <!-- –ò–∫–æ–Ω–∫–∏ -->
    <link rel="shortcut icon" href="https://kirill12633.github.io/Metro.New.Official/ru/images/metro-icon.png" type="image/png">
    <link rel="apple-touch-icon" href="https://kirill12633.github.io/Metro.New.Official/ru/images/metro-icon.png">
    
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase + App Check -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-check-compat.js"></script>
    
    <style>
        :root {
            --primary: #0066CC;
            --primary-dark: #0052a3;
            --secondary: #FFD700;
            --dark: #202124;
            --light: #ffffff;
            --gray: #5f6368;
            --gray-light: #f8f9fa;
            --gray-border: #dadce0;
            --success: #1e8e3e;
            --warning: #fbbc04;
            --danger: #d93025;
            --info: #1a73e8;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-md: 0 2px 6px rgba(0,0,0,0.15);
            --shadow-lg: 0 4px 12px rgba(0,0,0,0.2);
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Montserrat', sans-serif;
            background: #f8f9fa;
            color: var(--dark);
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .nav-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--primary);
            text-decoration: none;
            font-size: 0.9rem;
            padding: 8px 16px;
            background: white;
            border: 1px solid var(--gray-border);
            border-radius: var(--radius-sm);
            transition: all 0.2s;
        }
        
        .nav-link:hover {
            background: var(--gray-light);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }
        
        .card {
            background: white;
            border: 1px solid var(--gray-border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            overflow: hidden;
        }
        
        .card-header {
            padding: 24px 24px 16px;
            text-align: center;
            border-bottom: 1px solid var(--gray-border);
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 16px;
        }
        
        .logo-icon {
            width: 50px;
            height: 50px;
            background: var(--secondary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--dark);
            font-weight: bold;
            font-size: 1.5rem;
            box-shadow: var(--shadow-md);
        }
        
        .logo-text {
            font-size: 1.8rem;
            font-weight: 700;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .card-header h1 {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .card-header p {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .card-body {
            padding: 24px;
        }
        
        .card-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--gray-border);
            text-align: center;
            font-size: 0.75rem;
            color: var(--gray);
            background: var(--gray-light);
        }
        
        /* –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ */
        .categories {
            display: flex;
            gap: 10px;
            margin-bottom: 24px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .category-btn {
            padding: 8px 20px;
            background: white;
            border: 1px solid var(--gray-border);
            border-radius: 30px;
            color: var(--dark);
            font-weight: 500;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .category-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
            transform: translateY(-2px);
        }
        
        .category-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        /* –ü–æ–∏—Å–∫ */
        .search-container {
            max-width: 500px;
            margin: 0 auto 24px;
            position: relative;
        }
        
        .search-box {
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 12px 12px 45px;
            border: 2px solid var(--gray-border);
            border-radius: 30px;
            font-size: 1rem;
            transition: all 0.3s;
            background: white;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0,102,204,0.1);
        }
        
        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }
        
        /* –°–µ—Ç–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π */
        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .news-card {
            background: white;
            border: 1px solid var(--gray-border);
            border-radius: var(--radius-md);
            overflow: hidden;
            text-decoration: none;
            color: var(--dark);
            transition: all 0.3s;
            position: relative;
            box-shadow: var(--shadow-sm);
        }
        
        .news-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }
        
        .news-image {
            height: 160px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            position: relative;
        }
        
        .news-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: var(--secondary);
            color: var(--dark);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            box-shadow: var(--shadow-sm);
            z-index: 2;
        }
        
        .category-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0,0,0,0.6);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 500;
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            gap: 5px;
            z-index: 2;
        }
        
        .news-content {
            padding: 20px;
        }
        
        .news-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary);
            line-height: 1.4;
        }
        
        .news-excerpt {
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .news-meta {
            display: flex;
            gap: 15px;
            color: var(--gray);
            font-size: 0.8rem;
            flex-wrap: wrap;
            border-top: 1px solid var(--gray-border);
            padding-top: 15px;
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .important-badge {
            background: var(--warning);
            color: var(--dark);
            font-size: 0.7rem;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 4px;
            margin-left: 10px;
        }
        
        /* –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–æ–≤–æ—Å—Ç–∏ */
        .news-detail-image {
            width: 100%;
            height: 300px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: var(--radius-md);
            margin-bottom: 20px;
            position: relative;
        }
        
        .news-detail-badge {
            position: absolute;
            top: 20px;
            left: 20px;
            background: var(--secondary);
            color: var(--dark);
            padding: 8px 20px;
            border-radius: 30px;
            font-weight: 700;
            box-shadow: var(--shadow-md);
        }
        
        .news-detail-category {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.6);
            color: white;
            padding: 8px 20px;
            border-radius: 30px;
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .news-detail-title {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        .news-detail-meta {
            display: flex;
            gap: 25px;
            padding: 15px 20px;
            background: var(--gray-light);
            border-radius: var(--radius-md);
            margin-bottom: 25px;
            color: var(--gray);
            font-size: 0.9rem;
            flex-wrap: wrap;
        }
        
        .news-detail-content {
            line-height: 1.8;
            color: var(--dark);
            padding: 20px 0;
        }
        
        /* –†–µ–π—Ç–∏–Ω–≥ */
        .rating-section {
            margin: 30px 0;
            padding: 25px;
            background: var(--gray-light);
            border: 1px solid var(--gray-border);
            border-radius: var(--radius-md);
            text-align: center;
        }
        
        .rating-title {
            font-size: 1.1rem;
            color: var(--dark);
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .rating-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .rating-btn {
            padding: 12px 40px;
            border: 1px solid var(--gray-border);
            border-radius: 30px;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .rating-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .rating-btn.like:hover:not(:disabled) {
            background: var(--success);
            color: white;
            border-color: var(--success);
            transform: translateY(-3px);
        }
        
        .rating-btn.dislike:hover:not(:disabled) {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
            transform: translateY(-3px);
        }
        
        .rating-stats {
            color: var(--gray);
            font-size: 1rem;
        }
        
        .rating-stats i {
            color: #ffc107;
            margin: 0 2px;
        }
        
        /* –ü–æ–¥–µ–ª–∏—Ç—å—Å—è */
        .share-section {
            margin: 30px 0;
            padding: 25px;
            background: var(--gray-light);
            border: 1px solid var(--gray-border);
            border-radius: var(--radius-md);
        }
        
        .share-title {
            font-size: 1.1rem;
            color: var(--dark);
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }
        
        .share-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .share-btn {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-decoration: none;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            font-size: 1.3rem;
        }
        
        .share-btn:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: var(--shadow-md);
        }
        
        .share-btn.telegram { background: #0088cc; }
        .share-btn.whatsapp { background: #25D366; }
        .share-btn.vk { background: #4a76a8; }
        .share-btn.twitter { background: #1DA1F2; }
        .share-btn.copy { background: var(--gray); }
        
        .copy-message {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--success);
            color: white;
            padding: 12px 25px;
            border-radius: 30px;
            font-size: 0.9rem;
            z-index: 9999;
            animation: slideUp 0.3s ease;
            box-shadow: var(--shadow-lg);
        }
        
        @keyframes slideUp {
            from { transform: translate(-50%, 100%); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }
        
        /* –ü–∞–≥–∏–Ω–∞—Ü–∏—è */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 30px 0;
        }
        
        .page-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: white;
            border: 1px solid var(--gray-border);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .page-btn:hover:not(:disabled) {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            transform: translateY(-2px);
        }
        
        .page-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 12px 30px;
            background: var(--primary);
            color: white;
            text-decoration: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }
        
        .loading {
            text-align: center;
            padding: 60px;
            color: var(--gray);
        }
        
        .error-message {
            text-align: center;
            padding: 40px;
            color: var(--danger);
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .footer-links a {
            color: var(--gray);
            text-decoration: none;
        }
        
        .footer-links a:hover { color: var(--primary); }
        
        @media (max-width: 768px) {
            .news-grid {
                grid-template-columns: 1fr;
            }
            
            .news-detail-title {
                font-size: 1.5rem;
            }
            
            .rating-buttons {
                flex-direction: column;
            }
            
            .rating-btn {
                width: 100%;
                justify-content: center;
            }
            
            .share-buttons {
                gap: 10px;
            }
            
            .share-btn {
                width: 45px;
                height: 45px;
                font-size: 1.1rem;
            }
            
            .navigation {
                flex-direction: column;
            }
            
            .nav-link {
                width: 100%;
                justify-content: center;
            }
        }
        
        @media (prefers-color-scheme: dark) {
            :root {
                --dark: #e8eaed;
                --light: #202124;
                --gray: #9aa0a6;
                --gray-light: #292a2d;
                --gray-border: #5f6368;
            }
            body { background: #1a1a1a; }
            .card { background: var(--light); }
            .nav-link, .category-btn, .rating-btn, .page-btn {
                background: var(--light);
                color: var(--dark);
            }
            .search-input {
                background: var(--light);
                color: var(--dark);
            }
            .rating-section, .share-section {
                background: var(--light);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <div class="navigation">
            <a href="https://kirill12633.github.io/Metro.New.Official/ru/" class="nav-link">
                <i class="fas fa-home"></i> –ù–∞ –≥–ª–∞–≤–Ω—É—é
            </a>
            <a href="https://kirill12633.github.io/support.metro.new/" class="nav-link">
                <i class="fas fa-headset"></i> –ü–æ–¥–¥–µ—Ä–∂–∫–∞
            </a>
        </div>
        
        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ -->
        <div class="card">
            <div class="card-header">
                <div class="logo">
                    <div class="logo-icon">M</div>
                    <div class="logo-text">–ú–µ—Ç—Ä–æ New</div>
                </div>
                <h1 id="pageTitle">–ù–æ–≤–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞</h1>
                <p id="pageSubtitle">–ë—É–¥—å—Ç–µ –≤ –∫—É—Ä—Å–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–±—ã—Ç–∏–π</p>
            </div>
            
            <div class="card-body" id="contentContainer">
                <div class="loading">
                    <i class="fas fa-spinner fa-spin fa-2x"></i>
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π...</p>
                </div>
            </div>
            
            <div class="card-footer">
                <div id="copyrightYear"></div>
                <div class="footer-links">
                    <a href="https://kirill12633.github.io/Metro.New.Official/ru/help/privacy-policy/">–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</a>
                    <a href="https://kirill12633.github.io/Metro.New.Official/ru/help/terms-of-service/">–£—Å–ª–æ–≤–∏—è</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø FIREBASE =====
        firebase.initializeApp({
            apiKey: "AIzaSyAVSAXTU1VqF36GJA1pQOfxRxo3_ixW7F4",
            authDomain: "metro-new-admin.firebaseapp.com",
            projectId: "metro-new-admin",
            storageBucket: "metro-new-admin.firebasestorage.app",
            messagingSenderId: "769002010414",
            appId: "1:769002010414:web:bdeb93a7eddc4cab63ecbf"
        });

        // ===== APP CHECK =====
        try {
            firebase.appCheck().activate(
                '6LfgAZkrAAAAAOOU9svqDc-yVa23p4BRbEfElYJ-',
                true
            );
            console.log('‚úÖ App Check –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
        } catch (e) {
            console.warn('‚ö†Ô∏è App Check –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω:', e);
        }

        const db = firebase.firestore();
        
        // –¢–µ–∫—É—â–∏–π –≥–æ–¥
        document.getElementById('copyrightYear').textContent = `¬© ${new Date().getFullYear()} –ú–µ—Ç—Ä–æ New. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.`;
        
        // –ü–æ–ª—É—á–∞–µ–º ID –∏–∑ URL
        const urlParams = new URLSearchParams(window.location.search);
        const newsId = urlParams.get('id');
        let currentPage = 1;
        let currentCategory = 'all';
        let searchTerm = '';

        // ===== –£–í–ï–õ–ò–ß–ï–ù–ò–ï –ü–†–û–°–ú–û–¢–†–û–í =====
        async function incrementViews(docRef) {
            try {
                const doc = await docRef.get();
                if (!doc.exists) return;
                
                const currentViews = doc.data().views || 0;
                await docRef.update({
                    views: currentViews + 1
                });
                console.log('‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞—Å—á–∏—Ç–∞–Ω');
            } catch (error) {
                console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä—ã:', error);
            }
        }

        // ===== –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –†–ï–ô–¢–ò–ù–ì–ê =====
        window.rateNews = async function(value) {
            if (!newsId) return;
            
            const voted = localStorage.getItem(`rated_news_${newsId}`);
            if (voted) {
                alert('–í—ã —É–∂–µ –æ—Ü–µ–Ω–∏–ª–∏ —ç—Ç—É –Ω–æ–≤–æ—Å—Ç—å');
                return;
            }
            
            try {
                const docRef = db.collection('news').doc(newsId);
                const doc = await docRef.get();
                
                if (!doc.exists) return;
                
                const currentRatings = doc.data().ratings || [];
                
                await docRef.update({
                    ratings: [...currentRatings, {
                        value: value,
                        date: new Date().toISOString()
                    }]
                });
                
                localStorage.setItem(`rated_news_${newsId}`, 'true');
                alert('–°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ü–µ–Ω–∫—É!');
                loadNewsContent();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                if (error.code === 'permission-denied') {
                    alert('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞');
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –æ—Ü–µ–Ω–∫–∏');
                }
            }
        };

        // ===== –ü–û–î–ï–õ–ò–¢–¨–°–Ø =====
        window.shareNews = function(platform) {
            const url = window.location.href;
            const title = document.getElementById('pageTitle').textContent;
            const description = document.getElementById('pageSubtitle').textContent;
            
            let shareUrl = '';
            
            switch(platform) {
                case 'telegram':
                    shareUrl = `https://t.me/share/url?url=${encodeURIComponent(url)}&text=${encodeURIComponent(title)}`;
                    break;
                case 'whatsapp':
                    shareUrl = `https://wa.me/?text=${encodeURIComponent(title + ' ' + url)}`;
                    break;
                case 'vk':
                    shareUrl = `https://vk.com/share.php?url=${encodeURIComponent(url)}&title=${encodeURIComponent(title)}&description=${encodeURIComponent(description)}`;
                    break;
                case 'twitter':
                    shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(title)}&url=${encodeURIComponent(url)}`;
                    break;
                case 'copy':
                    navigator.clipboard.writeText(url).then(() => {
                        const msg = document.createElement('div');
                        msg.className = 'copy-message';
                        msg.textContent = '–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!';
                        document.body.appendChild(msg);
                        setTimeout(() => msg.remove(), 2000);
                    });
                    return;
            }
            
            if (shareUrl) {
                window.open(shareUrl, '_blank', 'width=600,height=400');
            }
        };

        // ===== –§–ò–õ–¨–¢–†–ê–¶–ò–Ø –ü–û –ö–ê–¢–ï–ì–û–†–ò–Ø–ú =====
        window.filterByCategory = function(category) {
            currentCategory = category;
            currentPage = 1;
            loadNewsList();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.category === category) {
                    btn.classList.add('active');
                }
            });
        };

        // ===== –ü–û–ò–°–ö =====
        window.handleSearch = function() {
            searchTerm = document.getElementById('searchInput').value.toLowerCase();
            currentPage = 1;
            loadNewsList();
        };

        // ===== –ü–ê–ì–ò–ù–ê–¶–ò–Ø =====
        window.changePage = function(direction) {
            if (direction === 'prev' && currentPage > 1) {
                currentPage--;
                loadNewsList();
            } else if (direction === 'next') {
                currentPage++;
                loadNewsList();
            }
        };

        // ===== –ó–ê–ì–†–£–ó–ö–ê –°–ü–ò–°–ö–ê –ù–û–í–û–°–¢–ï–ô =====
        async function loadNewsList() {
            const container = document.getElementById('contentContainer');
            
            try {
                let query = db.collection('news')
                    .where('status', '==', 'published')
                    .orderBy('createdAt', 'desc');
                
                const snapshot = await query.get();
                
                if (snapshot.empty) {
                    container.innerHTML = '<p style="text-align: center; padding: 40px;">–ü–æ–∫–∞ –Ω–µ—Ç –Ω–æ–≤–æ—Å—Ç–µ–π</p>';
                    return;
                }
                
                let allNews = [];
                snapshot.forEach(doc => {
                    allNews.push({ id: doc.id, ...doc.data() });
                });
                
                // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                if (currentCategory !== 'all') {
                    allNews = allNews.filter(news => news.category === currentCategory);
                }
                
                // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ–∏—Å–∫—É
                if (searchTerm) {
                    allNews = allNews.filter(news => 
                        (news.title && news.title.toLowerCase().includes(searchTerm)) ||
                        (news.excerpt && news.excerpt.toLowerCase().includes(searchTerm))
                    );
                }
                
                // –ü–∞–≥–∏–Ω–∞—Ü–∏—è (–ø–æ 6 –Ω–æ–≤–æ—Å—Ç–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É)
                const pageSize = 6;
                const totalPages = Math.ceil(allNews.length / pageSize);
                const start = (currentPage - 1) * pageSize;
                const paginatedNews = allNews.slice(start, start + pageSize);
                
                // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML
                let html = `
                    <!-- –ü–æ–∏—Å–∫ -->
                    <div class="search-container">
                        <div class="search-box">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" id="searchInput" class="search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–≤–æ—Å—Ç—è–º..." oninput="handleSearch()" value="${searchTerm}">
                        </div>
                    </div>
                    
                    <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
                    <div class="categories">
                        <button class="category-btn ${currentCategory === 'all' ? 'active' : ''}" data-category="all" onclick="filterByCategory('all')">–í—Å–µ</button>
                        <button class="category-btn ${currentCategory === 'update' ? 'active' : ''}" data-category="update" onclick="filterByCategory('update')">–û–±–Ω–æ–≤–ª–µ–Ω–∏—è</button>
                        <button class="category-btn ${currentCategory === 'event' ? 'active' : ''}" data-category="event" onclick="filterByCategory('event')">–°–æ–±—ã—Ç–∏—è</button>
                        <button class="category-btn ${currentCategory === 'important' ? 'active' : ''}" data-category="important" onclick="filterByCategory('important')">–í–∞–∂–Ω–æ–µ</button>
                        <button class="category-btn ${currentCategory === 'announcement' ? 'active' : ''}" data-category="announcement" onclick="filterByCategory('announcement')">–ê–Ω–æ–Ω—Å—ã</button>
                    </div>
                    
                    <div class="news-grid">
                `;
                
                paginatedNews.forEach(news => {
                    const date = news.createdAt?.toDate ? 
                        news.createdAt.toDate().toLocaleDateString('ru-RU') : 
                        new Date().toLocaleDateString('ru-RU');
                    
                    const categoryNames = {
                        'update': '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ',
                        'event': '–°–æ–±—ã—Ç–∏–µ',
                        'important': '–í–∞–∂–Ω–æ–µ',
                        'announcement': '–ê–Ω–æ–Ω—Å'
                    };
                    
                    const categoryIcons = {
                        'update': 'fa-sync-alt',
                        'event': 'fa-calendar-alt',
                        'important': 'fa-exclamation-circle',
                        'announcement': 'fa-bullhorn'
                    };
                    
                    const safeTitle = news.title ? String(news.title).replace(/[<>]/g, '') : '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
                    const safeExcerpt = news.excerpt ? String(news.excerpt).replace(/[<>]/g, '') : '';
                    
                    html += `
                        <a href="?id=${news.id}" class="news-card">
                            <div class="news-image">
                                ${news.badge ? `<span class="news-badge">${news.badge}</span>` : ''}
                                <span class="category-badge">
                                    <i class="fas ${categoryIcons[news.category] || 'fa-newspaper'}"></i>
                                    ${categoryNames[news.category] || '–ù–æ–≤–æ—Å—Ç—å'}
                                </span>
                            </div>
                            <div class="news-content">
                                <h3 class="news-title">
                                    ${safeTitle}
                                    ${news.important ? '<span class="important-badge">–í–∞–∂–Ω–æ!</span>' : ''}
                                </h3>
                                <p class="news-excerpt">${safeExcerpt}</p>
                                <div class="news-meta">
                                    <span class="meta-item">
                                        <i class="far fa-calendar-alt"></i> ${date}
                                    </span>
                                    <span class="meta-item">
                                        <i class="far fa-eye"></i> ${news.views || 0}
                                    </span>
                                    ${news.ratings ? `
                                    <span class="meta-item">
                                        <i class="fas fa-star" style="color: #ffc107;"></i> 
                                        ${news.ratings.length}
                                    </span>
                                    ` : ''}
                                </div>
                            </div>
                        </a>
                    `;
                });
                
                html += '</div>';
                
                // –ü–∞–≥–∏–Ω–∞—Ü–∏—è
                if (totalPages > 1) {
                    html += `
                        <div class="pagination">
                            <button class="page-btn" onclick="changePage('prev')" ${currentPage === 1 ? 'disabled' : ''}>
                                <i class="fas fa-chevron-left"></i>
                            </button>
                    `;
                    
                    for (let i = 1; i <= totalPages; i++) {
                        html += `
                            <button class="page-btn ${currentPage === i ? 'active' : ''}" onclick="currentPage = ${i}; loadNewsList();">
                                ${i}
                            </button>
                        `;
                    }
                    
                    html += `
                            <button class="page-btn" onclick="changePage('next')" ${currentPage === totalPages ? 'disabled' : ''}>
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    `;
                }
                
                container.innerHTML = html;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                container.innerHTML = '<div class="error-message"><i class="fas fa-exclamation-triangle"></i> –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ—Å—Ç–µ–π</div>';
            }
        }

        // ===== –ó–ê–ì–†–£–ó–ö–ê –û–î–ù–û–ô –ù–û–í–û–°–¢–ò =====
        async function loadSingleNews() {
            const container = document.getElementById('contentContainer');
            
            try {
                const docRef = db.collection('news').doc(newsId);
                const docSnap = await docRef.get();
                
                if (docSnap.exists) {
                    const data = docSnap.data();
                    
                    document.getElementById('pageTitle').textContent = 
                        data.title ? String(data.title).replace(/[<>]/g, '') : '–ù–æ–≤–æ—Å—Ç—å';
                    document.getElementById('pageSubtitle').textContent = 
                        data.excerpt ? String(data.excerpt).replace(/[<>]/g, '') : '';
                    
                    const date = data.createdAt?.toDate ? 
                        data.createdAt.toDate().toLocaleDateString('ru-RU', {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                        }) : new Date().toLocaleDateString('ru-RU');
                    
                    await incrementViews(docRef);
                    
                    // –ü–æ–¥—Å—á—ë—Ç —Ä–µ–π—Ç–∏–Ω–≥–∞
                    let ratingText = '–ù–µ—Ç –æ—Ü–µ–Ω–æ–∫';
                    let likeCount = 0;
                    let totalRatings = 0;
                    
                    if (data.ratings && data.ratings.length > 0) {
                        totalRatings = data.ratings.length;
                        likeCount = data.ratings.filter(r => r.value === 1).length;
                        const percent = Math.round((likeCount / totalRatings) * 100);
                        ratingText = `üëç ${likeCount} (${percent}%) –∏–∑ ${totalRatings}`;
                    }
                    
                    const voted = localStorage.getItem(`rated_news_${newsId}`);
                    
                    const categoryNames = {
                        'update': '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ',
                        'event': '–°–æ–±—ã—Ç–∏–µ',
                        'important': '–í–∞–∂–Ω–æ–µ',
                        'announcement': '–ê–Ω–æ–Ω—Å'
                    };
                    
                    const categoryIcons = {
                        'update': 'fa-sync-alt',
                        'event': 'fa-calendar-alt',
                        'important': 'fa-exclamation-circle',
                        'announcement': 'fa-bullhorn'
                    };
                    
                    container.innerHTML = `
                        <div class="news-detail-image">
                            ${data.badge ? `<span class="news-detail-badge">${data.badge}</span>` : ''}
                            <span class="news-detail-category">
                                <i class="fas ${categoryIcons[data.category] || 'fa-newspaper'}"></i>
                                ${categoryNames[data.category] || '–ù–æ–≤–æ—Å—Ç—å'}
                            </span>
                        </div>
                        
                        <h1 class="news-detail-title">${data.title || ''}</h1>
                        
                        <div class="news-detail-meta">
                            <span><i class="far fa-calendar-alt"></i> ${date}</span>
                            <span><i class="far fa-eye"></i> ${data.views || 0} –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</span>
                            ${data.important ? '<span><i class="fas fa-star" style="color: #ffc107;"></i> –í–∞–∂–Ω–∞—è –Ω–æ–≤–æ—Å—Ç—å</span>' : ''}
                        </div>
                        
                        <div class="news-detail-content">
                            ${data.content || ''}
                        </div>
                        
                        <!-- –†–ï–ô–¢–ò–ù–ì -->
                        <div class="rating-section">
                            <div class="rating-title">–ë—ã–ª–∞ –ª–∏ –Ω–æ–≤–æ—Å—Ç—å –ø–æ–ª–µ–∑–Ω–æ–π?</div>
                            <div class="rating-buttons">
                                <button class="rating-btn like" onclick="rateNews(1)" ${voted ? 'disabled' : ''}>
                                    <i class="fas fa-thumbs-up"></i> –î–∞
                                </button>
                                <button class="rating-btn dislike" onclick="rateNews(0)" ${voted ? 'disabled' : ''}>
                                    <i class="fas fa-thumbs-down"></i> –ù–µ—Ç
                                </button>
                            </div>
                            <div class="rating-stats">
                                <i class="fas fa-star"></i> ${ratingText}
                            </div>
                        </div>
                        
                        <!-- –ü–û–î–ï–õ–ò–¢–¨–°–Ø -->
                        <div class="share-section">
                            <div class="share-title">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–≤–æ—Å—Ç—å—é</div>
                            <div class="share-buttons">
                                <button class="share-btn telegram" onclick="shareNews('telegram')">
                                    <i class="fab fa-telegram-plane"></i>
                                </button>
                                <button class="share-btn whatsapp" onclick="shareNews('whatsapp')">
                                    <i class="fab fa-whatsapp"></i>
                                </button>
                                <button class="share-btn vk" onclick="shareNews('vk')">
                                    <i class="fab fa-vk"></i>
                                </button>
                                <button class="share-btn twitter" onclick="shareNews('twitter')">
                                    <i class="fab fa-twitter"></i>
                                </button>
                                <button class="share-btn copy" onclick="shareNews('copy')">
                                    <i class="fas fa-link"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div style="text-align: center;">
                            <a href="news.html" class="btn btn-outline">
                                <i class="fas fa-arrow-left"></i> –í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏
                            </a>
                        </div>
                    `;
                } else {
                    container.innerHTML = '<div class="error-message">–ù–æ–≤–æ—Å—Ç—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</div>';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                container.innerHTML = '<div class="error-message">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ—Å—Ç–∏</div>';
            }
        }

        // ===== –ó–ê–ü–£–°–ö =====
        function loadContent() {
            if (newsId) {
                loadSingleNews();
            } else {
                loadNewsList();
            }
        }
        
        loadContent();
    </script>
</body>
</html>
