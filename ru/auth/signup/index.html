<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>–ú–µ—Ç—Ä–æ New - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≤—Ö–æ–¥</title>
    
    <!-- –®—Ä–∏—Ñ—Ç—ã –∏ –∏–∫–æ–Ω–∫–∏ -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- –ù–∞—à CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="auth-container">
        <!-- –û–°–ù–û–í–ù–ê–Ø –ö–ê–†–¢–û–ß–ö–ê -->
        <div class="auth-card" id="registerCard">
            <!-- –•–ï–î–ï–† -->
            <div class="auth-header">
                <div class="logo">
                    <div class="logo-icon">M</div>
                    <div class="logo-text">–ú–µ—Ç—Ä–æ New</div>
                </div>
                <h2 class="auth-title" id="formTitle">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</h2>
                <p class="auth-subtitle" id="formSubtitle">–î–ª—è –≤—Ö–æ–¥–∞ –≤ –ú–µ—Ç—Ä–æ New</p>
            </div>
            
            <!-- –¢–ï–õ–û –ö–ê–†–¢–û–ß–ö–ò -->
            <div class="auth-body">
                <!-- –§–û–†–ú–ê –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò -->
                <div class="form-container active" id="registerForm">
                    <!-- –ü–†–û–ì–†–ï–°–° –ë–ê–† -->
                    <div class="registration-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill" style="width: 33%"></div>
                        </div>
                        <div class="progress-steps">
                            <div class="step active" data-step="1">
                                <div class="step-number">1</div>
                                <span class="step-label">–û—Å–Ω–æ–≤–Ω–æ–µ</span>
                            </div>
                            <div class="step" data-step="2">
                                <div class="step-number">2</div>
                                <span class="step-label">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ</span>
                            </div>
                            <div class="step" data-step="3">
                                <div class="step-number">3</div>
                                <span class="step-label">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –®–ê–ì 1: –û–°–ù–û–í–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø -->
                    <div class="registration-step active" id="step1">
                        <form id="step1Form">
                            <!-- –ò–ú–Ø -->
                            <div class="form-group">
                                <label class="form-label">–ò–º—è</label>
                                <input type="text" class="form-input" id="firstName" 
                                       placeholder="–í–∞—à–µ –∏–º—è" maxlength="30" required>
                                <div class="form-hint" id="firstNameHint">
                                    –ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è
                                </div>
                            </div>
                            
                            <!-- –§–ê–ú–ò–õ–ò–Ø -->
                            <div class="form-group">
                                <label class="form-label">–§–∞–º–∏–ª–∏—è <span class="optional">(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</span></label>
                                <input type="text" class="form-input" id="lastName" 
                                       placeholder="–í–∞—à–∞ —Ñ–∞–º–∏–ª–∏—è" maxlength="30">
                                <div class="form-hint" id="lastNameHint"></div>
                            </div>
                            
                            <!-- –ù–ò–ö–ù–ï–ô–ú -->
                            <div class="form-group">
                                <label class="form-label">–ù–∏–∫–Ω–µ–π–º</label>
                                <input type="text" class="form-input" id="username" 
                                       placeholder="–£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" maxlength="20" required>
                                <div class="form-hint" id="usernameHint">
                                    –ë—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
                                </div>
                                <div class="username-suggestions" id="usernameSuggestions" style="display: none;">
                                    <div style="font-size: 0.75rem; color: var(--gray); margin-bottom: 4px;">
                                        –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:
                                    </div>
                                    <div class="suggestions-list" id="suggestionsList"></div>
                                </div>
                            </div>
                            
                            <!-- –î–ê–¢–ê –†–û–ñ–î–ï–ù–ò–Ø -->
                            <div class="form-group">
                                <label class="form-label">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
                                <div class="birthday-group">
                                    <select class="birthday-select" id="birthDay" required>
                                        <option value="">–î–µ–Ω—å</option>
                                    </select>
                                    <select class="birthday-select" id="birthMonth" required>
                                        <option value="">–ú–µ—Å—è—Ü</option>
                                        <option value="1">–Ø–Ω–≤–∞—Ä—å</option>
                                        <option value="2">–§–µ–≤—Ä–∞–ª—å</option>
                                        <option value="3">–ú–∞—Ä—Ç</option>
                                        <option value="4">–ê–ø—Ä–µ–ª—å</option>
                                        <option value="5">–ú–∞–π</option>
                                        <option value="6">–ò—é–Ω—å</option>
                                        <option value="7">–ò—é–ª—å</option>
                                        <option value="8">–ê–≤–≥—É—Å—Ç</option>
                                        <option value="9">–°–µ–Ω—Ç—è–±—Ä—å</option>
                                        <option value="10">–û–∫—Ç—è–±—Ä—å</option>
                                        <option value="11">–ù–æ—è–±—Ä—å</option>
                                        <option value="12">–î–µ–∫–∞–±—Ä—å</option>
                                    </select>
                                    <select class="birthday-select" id="birthYear" required>
                                        <option value="">–ì–æ–¥</option>
                                    </select>
                                </div>
                                <div class="form-hint" id="birthDayHint">
                                    –î–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤–æ–∑—Ä–∞—Å—Ç–∞
                                </div>
                            </div>
                            
                            <!-- –ö–ù–û–ü–ö–ò –ù–ê–í–ò–ì–ê–¶–ò–ò -->
                            <div class="step-navigation">
                                <button type="button" class="btn btn-secondary" id="cancelRegistration">
                                    –û—Ç–º–µ–Ω–∞
                                </button>
                                <button type="button" class="btn btn-primary" id="nextStep1">
                                    –î–∞–ª–µ–µ
                                    <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- –®–ê–ì 2: –ü–ê–†–û–õ–¨ –ò EMAIL -->
                    <div class="registration-step" id="step2">
                        <form id="step2Form">
                            <!-- EMAIL -->
                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-input" id="email" 
                                       placeholder="your@email.com" required>
                                <div class="form-hint" id="emailHint">
                                    –í–∞—à email –¥–ª—è –≤—Ö–æ–¥–∞
                                </div>
                            </div>
                            
                            <!-- –ü–ê–†–û–õ–¨ -->
                            <div class="form-group">
                                <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                                <div class="password-wrapper">
                                    <input type="password" class="form-input" id="password" 
                                           placeholder="–°–æ–∑–¥–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                                    <button type="button" class="toggle-password" id="togglePassword">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <div class="password-strength" id="passwordStrength">
                                    <div class="strength-bar">
                                        <div class="strength-fill"></div>
                                    </div>
                                    <div class="strength-text" id="strengthText">–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</div>
                                </div>
                                <div class="strength-requirements" id="passwordRequirements">
                                    <div class="requirement" id="reqLength">
                                        <i class="fas fa-circle"></i>
                                        <span>–ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤</span>
                                    </div>
                                    <div class="requirement" id="reqUppercase">
                                        <i class="fas fa-circle"></i>
                                        <span>–ó–∞–≥–ª–∞–≤–Ω–∞—è –±—É–∫–≤–∞</span>
                                    </div>
                                    <div class="requirement" id="reqLowercase">
                                        <i class="fas fa-circle"></i>
                                        <span>–°—Ç—Ä–æ—á–Ω–∞—è –±—É–∫–≤–∞</span>
                                    </div>
                                    <div class="requirement" id="reqNumber">
                                        <i class="fas fa-circle"></i>
                                        <span>–¶–∏—Ñ—Ä–∞</span>
                                    </div>
                                    <div class="requirement" id="reqSpecial">
                                        <i class="fas fa-circle"></i>
                                        <span>–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–∏–º–≤–æ–ª</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï –ü–ê–†–û–õ–Ø -->
                            <div class="form-group">
                                <label class="form-label">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                                <div class="password-wrapper">
                                    <input type="password" class="form-input" id="confirmPassword" 
                                           placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                                    <button type="button" class="toggle-password" id="toggleConfirmPassword">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <div class="form-hint" id="confirmPasswordHint">
                                    –ü–∞—Ä–æ–ª–∏ –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å
                                </div>
                            </div>
                            
                            <!-- –ö–ù–û–ü–ö–ò –ù–ê–í–ò–ì–ê–¶–ò–ò -->
                            <div class="step-navigation">
                                <button type="button" class="btn btn-secondary" id="prevStep2">
                                    <i class="fas fa-arrow-left"></i>
                                    –ù–∞–∑–∞–¥
                                </button>
                                <button type="button" class="btn btn-primary" id="nextStep2">
                                    –î–∞–ª–µ–µ
                                    <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- –®–ê–ì 3: –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï -->
                    <div class="registration-step" id="step3">
                        <form id="step3Form">
                            <!-- –°–û–ì–õ–ê–®–ï–ù–ò–Ø -->
                            <div class="form-group">
                                <div style="display: flex; align-items: flex-start; gap: 8px;">
                                    <input type="checkbox" id="agreeTerms" required style="margin-top: 3px;">
                                    <label for="agreeTerms" style="font-size: 0.875rem; color: var(--gray);">
                                        –Ø –ø—Ä–∏–Ω–∏–º–∞—é 
                                        <a href="#" class="terms-link" style="color: var(--primary); text-decoration: none;">
                                            –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ
                                        </a> 
                                        –∏ 
                                        <a href="#" class="privacy-link" style="color: var(--primary); text-decoration: none;">
                                            –ü–æ–ª–∏—Ç–∏–∫—É –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                                        </a>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- –ü–†–û–í–ï–†–ö–ê –î–ê–ù–ù–´–• -->
                            <div class="alert alert-info" id="dataSummary">
                                <i class="fas fa-info-circle"></i>
                                <div>
                                    <strong>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ:</strong>
                                    <div id="userDataSummary" style="margin-top: 4px; font-size: 0.8125rem;"></div>
                                </div>
                            </div>
                            
                            <!-- –°–û–û–ë–©–ï–ù–ò–Ø -->
                            <div class="alert alert-error" id="errorAlert" style="display: none;"></div>
                            
                            <!-- –ö–ù–û–ü–ö–ò -->
                            <div class="step-navigation">
                                <button type="button" class="btn btn-secondary" id="prevStep3">
                                    <i class="fas fa-arrow-left"></i>
                                    –ù–∞–∑–∞–¥
                                </button>
                                <button type="submit" class="btn btn-primary" id="submitRegistration">
                                    <i class="fas fa-user-plus"></i>
                                    –°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- –†–ê–ó–î–ï–õ–ò–¢–ï–õ–¨ -->
                    <div class="divider" id="registerDivider" style="display: none;">
                        <span>–∏–ª–∏</span>
                    </div>
                    
                    <!-- GOOGLE -->
                    <button class="btn btn-google btn-block" id="googleRegisterBtn" style="display: none;">
                        <i class="fab fa-google"></i>
                        –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å Google
                    </button>
                    
                    <!-- –°–°–´–õ–ö–ê –ù–ê –í–•–û–î -->
                    <div class="auth-links" id="registerLinks" style="display: none;">
                        <span style="color: var(--gray); font-size: 0.875rem;">
                            –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç?
                        </span>
                        <a href="#" class="auth-link" id="showLoginLink">–í–æ–π—Ç–∏</a>
                    </div>
                </div>
                
                <!-- –§–û–†–ú–ê –í–•–û–î–ê -->
                <div class="form-container" id="loginForm">
                    <form id="loginFormElement">
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-input" id="loginEmail" 
                                   placeholder="your@email.com" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                            <div class="password-wrapper">
                                <input type="password" class="form-input" id="loginPassword" 
                                       placeholder="–í–∞—à –ø–∞—Ä–æ–ª—å" required>
                                <button type="button" class="toggle-password" id="toggleLoginPassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div style="text-align: right; margin-bottom: 16px;">
                            <a href="#" class="auth-link" id="forgotPasswordLink">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</a>
                        </div>
                        
                        <div class="alert" id="loginErrorAlert" style="display: none;"></div>
                        
                        <button type="submit" class="btn btn-primary btn-block" id="loginBtn">
                            <i class="fas fa-sign-in-alt"></i>
                            –í–æ–π—Ç–∏
                        </button>
                    </form>
                    
                    <div class="divider">
                        <span>–∏–ª–∏</span>
                    </div>
                    
                    <button class="btn btn-google btn-block" id="googleLoginBtn">
                        <i class="fab fa-google"></i>
                        –í–æ–π—Ç–∏ —Å Google
                    </button>
                    
                    <div class="auth-links">
                        <span style="color: var(--gray); font-size: 0.875rem;">
                            –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞?
                        </span>
                        <a href="#" class="auth-link" id="showRegisterLink">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</a>
                    </div>
                </div>
                
                <!-- –°–ë–†–û–° –ü–ê–†–û–õ–Ø -->
                <div class="form-container" id="resetPasswordForm">
                    <form id="resetPasswordFormElement">
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-input" id="resetEmail" 
                                   placeholder="your@email.com" required>
                            <div class="form-hint">–í–≤–µ–¥–∏—Ç–µ email –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞</div>
                        </div>
                        
                        <div class="alert" id="resetErrorAlert" style="display: none;"></div>
                        
                        <div style="display: flex; gap: 8px;">
                            <button type="button" class="btn btn-secondary" id="cancelResetBtn">–û—Ç–º–µ–Ω–∞</button>
                            <button type="submit" class="btn btn-primary" id="resetPasswordBtn">
                                <i class="fas fa-paper-plane"></i>
                                –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- –ó–ê–ì–†–£–ó–ö–ê -->
                <div class="form-container" id="loadingScreen">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <span id="loadingText">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                </div>
                
                <!-- –ë–õ–û–ö–ò–†–û–í–ö–ê -13 –õ–ï–¢ -->
                <div class="form-container" id="ageRestrictionScreen">
                    <div class="age-restriction">
                        <div class="age-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <h3 class="age-title">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</h3>
                        <p class="age-text" id="ageRestrictionMessage">
                            –î–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –±—ã—Ç—å —Å—Ç–∞—Ä—à–µ 13 –ª–µ—Ç.
                        </p>
                        <div class="alert alert-warning" style="margin: 20px 0;">
                            <i class="fas fa-shield-alt"></i>
                            <div>
                                <strong>–í–∞–∂–Ω–æ:</strong><br>
                                –í–µ—Ä–Ω–∏—Ç–µ—Å—å, –∫–æ–≥–¥–∞ –≤–∞–º –∏—Å–ø–æ–ª–Ω–∏—Ç—Å—è 13 –ª–µ—Ç
                            </div>
                        </div>
                        <button class="btn btn-primary btn-block" id="goToParentPageBtn">
                            <i class="fas fa-external-link-alt"></i>
                            –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª–µ–π
                        </button>
                        <div class="auth-links" style="margin-top: 16px;">
                            <a href="#" class="auth-link" id="backFromAgeRestriction">
                                <i class="fas fa-arrow-left"></i>
                                –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥
                            </a>
                        </div>
                    </div>
                </div>
                
                <!-- –£–°–ü–ï–• -->
                <div class="form-container" id="successScreen">
                    <div class="success-screen">
                        <div class="success-icon">
                            <i class="fas fa-check"></i>
                        </div>
                        <h3 class="success-title">–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω!</h3>
                        <p class="success-text" id="successMessage">
                            –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à email –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
                        </p>
                        <div class="email-timer" style="margin-bottom: 20px; padding: 10px; background: rgba(0,102,204,0.1); border-radius: 8px;">
                            <div style="display: flex; align-items: center; gap: 8px; justify-content: center;">
                                <i class="fas fa-envelope" style="color: var(--primary);"></i>
                                <span style="font-size: 0.875rem;">–ù–µ –ø–æ–ª—É—á–∏–ª–∏ –ø–∏—Å—å–º–æ?</span>
                            </div>
                            <button class="btn btn-secondary btn-block" id="resendEmailBtn" style="margin-top: 8px;">
                                <i class="fas fa-redo"></i>
                                <span id="resendTimerText">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ (60)</span>
                            </button>
                        </div>
                        <button class="btn btn-primary btn-block" id="goToLoginBtn">
                            <i class="fas fa-sign-in-alt"></i>
                            –ü–µ—Ä–µ–π—Ç–∏ –∫ –≤—Ö–æ–¥—É
                        </button>
                    </div>
                </div>
                
                <!-- –°–ë–†–û–° –£–°–ü–ï–• -->
                <div class="form-container" id="resetSuccessScreen">
                    <div class="success-screen">
                        <div class="success-icon">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <h3 class="success-title">–ü–∏—Å—å–º–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ</h3>
                        <p class="success-text" id="resetSuccessMessage">
                            –°—Å—ã–ª–∫–∞ –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ –≤–∞—à email
                        </p>
                        <button class="btn btn-primary btn-block" id="backToLoginFromResetBtn">
                            <i class="fas fa-arrow-left"></i>
                            –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –≤—Ö–æ–¥—É
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- –§–£–¢–ï–† -->
            <div class="auth-footer">
                <div id="copyrightYear">¬© 2026 –ú–µ—Ç—Ä–æ New. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</div>
                <div class="footer-links">
                    <a href="https://kirill12633.github.io/Metro.New.Official/ru/help" 
                       target="_blank" class="footer-link">–ü–æ–º–æ—â—å</a>
                    <a href="https://kirill12633.github.io/support.metro.new/" 
                       target="_blank" class="footer-link">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ú–û–î–ê–õ–ö–ê –ü–û–õ–ò–¢–ò–ö–ò -->
    <div class="policy-modal" id="policyModal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</h3>
                <button class="modal-close" id="closePolicyModal">√ó</button>
            </div>
            <div class="modal-body">
                <iframe class="modal-iframe" id="policyIframe"></iframe>
            </div>
            <div class="modal-footer">
                <div class="modal-buttons">
                    <button class="btn btn-secondary" id="closePolicyModalBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
                    <button class="btn btn-primary" id="acceptPolicyBtn">–ü—Ä–∏–Ω—è—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

<!-- –ï–î–ò–ù–´–ô –°–ö–†–ò–ü–¢ –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò -->
<script type="module">
// ============================================
// FIREBASE –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
// ============================================
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { 
    getAuth, 
    createUserWithEmailAndPassword,
    updateProfile,
    sendEmailVerification,
    signInWithPopup,
    GoogleAuthProvider,
    signInWithEmailAndPassword,
    sendPasswordResetEmail
} from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
import { 
    getFirestore, 
    doc, 
    setDoc, 
    serverTimestamp 
} from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyDNAyhui3Lc_IX0wuot7_Z6Vdf9Bw5A9mE",
    authDomain: "metro-new-85226.firebaseapp.com",
    databaseURL: "https://metro-new-85226-default-rtdb.firebaseio.com",
    projectId: "metro-new-85226",
    storageBucket: "metro-new-85226.firebasestorage.app",
    messagingSenderId: "905640751733",
    appId: "1:905640751733:web:f1ab3a1b119ca1e245fe3c"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const googleProvider = new GoogleAuthProvider();

// ============================================
// –§–ò–õ–¨–¢–† –ú–ê–¢–û–í (–£–ü–†–û–©–ï–ù–ù–´–ô)
// ============================================
const ProfanityFilter = {
    blacklist: ['—Ö—É–π', '–ø–∏–∑–¥–∞', '–±–ª—è–¥—å', '—Å—É–∫–∞', 'fuck', 'shit'],
    check(text) {
        if (!text) return { hasProfanity: false };
        const lowerText = text.toLowerCase();
        for (let word of this.blacklist) {
            if (lowerText.includes(word)) {
                return { hasProfanity: true, foundWords: [word] };
            }
        }
        return { hasProfanity: false };
    }
};

// ============================================
// –ü–†–û–í–ï–†–ö–ê –í–û–ó–†–ê–°–¢–ê
// ============================================
const AgeValidator = {
    minAge: 13,
    
    check(day, month, year) {
        if (!day || !month || !year) {
            return { isValid: false, message: '–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è' };
        }
        
        const today = new Date();
        const birthDate = new Date(year, month - 1, day);
        let age = today.getFullYear() - birthDate.getFullYear();
        const monthDiff = today.getMonth() - birthDate.getMonth();
        
        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
            age--;
        }
        
        if (age >= this.minAge) {
            return { isValid: true, age: age, message: `‚úÖ –í–æ–∑—Ä–∞—Å—Ç: ${age} –ª–µ—Ç` };
        } else {
            return { 
                isValid: false, 
                age: age, 
                message: `‚ùå –¢–µ–±–µ ${age} –ª–µ—Ç. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å 13 –ª–µ—Ç` 
            };
        }
    }
};

// ============================================
// –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø
// ============================================
const Notifications = {
    error(message) {
        alert('‚ùå ' + message);
    },
    warning(message) {
        alert('‚ö†Ô∏è ' + message);
    },
    success(message) {
        alert('‚úÖ ' + message);
    }
};

// ============================================
// –û–°–ù–û–í–ù–û–ô –ö–û–î
// ============================================
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ –°–∏—Å—Ç–µ–º–∞ –∑–∞–ø—É—â–µ–Ω–∞');
    fillDateSelectors();
    initEventHandlers();
});

// ========== –ó–ê–ü–û–õ–ù–ï–ù–ò–ï –î–ê–¢ ==========
function fillDateSelectors() {
    const daySelect = document.getElementById('birthDay');
    const yearSelect = document.getElementById('birthYear');
    const currentYear = new Date().getFullYear();
    
    if (!daySelect || !yearSelect) return;
    
    daySelect.innerHTML = '<option value="">–î–µ–Ω—å</option>';
    yearSelect.innerHTML = '<option value="">–ì–æ–¥</option>';
    
    for (let i = 1; i <= 31; i++) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = i;
        daySelect.appendChild(option);
    }
    
    for (let i = currentYear; i >= currentYear - 100; i--) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = i;
        yearSelect.appendChild(option);
    }
    
    console.log('‚úÖ –î–∞—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
}

// ========== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò ==========
function initEventHandlers() {
    // –®–∞–≥ 1 -> –®–∞–≥ 2
    document.getElementById('nextStep1')?.addEventListener('click', function(e) {
        e.preventDefault();
        
        const firstName = document.getElementById('firstName')?.value.trim();
        const username = document.getElementById('username')?.value.trim();
        const birthDay = document.getElementById('birthDay')?.value;
        const birthMonth = document.getElementById('birthMonth')?.value;
        const birthYear = document.getElementById('birthYear')?.value;
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–µ–Ω–∏
        if (!firstName) {
            document.getElementById('firstNameHint').textContent = '–í–≤–µ–¥–∏—Ç–µ –∏–º—è';
            document.getElementById('firstNameHint').className = 'form-hint error';
            return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∏–∫–∞
        if (!username) {
            document.getElementById('usernameHint').textContent = '–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º';
            document.getElementById('usernameHint').className = 'form-hint error';
            return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ç–æ–≤
        const profanityCheck = ProfanityFilter.check(username);
        if (profanityCheck.hasProfanity) {
            document.getElementById('usernameHint').textContent = '–ù–∏–∫–Ω–µ–π–º —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞';
            document.getElementById('usernameHint').className = 'form-hint error';
            return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑—Ä–∞—Å—Ç–∞
        const ageCheck = AgeValidator.check(birthDay, birthMonth, birthYear);
        if (!ageCheck.isValid) {
            document.getElementById('birthDayHint').textContent = ageCheck.message;
            document.getElementById('birthDayHint').className = 'form-hint error';
            return;
        }
        
        if (ageCheck.age < 13) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
            document.querySelectorAll('.form-container').forEach(f => f.classList.remove('active'));
            document.getElementById('ageRestrictionScreen').classList.add('active');
            
            const messageEl = document.getElementById('ageRestrictionMessage');
            if (messageEl) {
                messageEl.innerHTML = `–¢–µ–±–µ ${ageCheck.age} –ª–µ—Ç. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Å 13 –ª–µ—Ç.`;
            }
            return;
        }
        
        // –í—Å—ë —Ö–æ—Ä–æ—à–æ - –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —à–∞–≥ 2
        document.querySelectorAll('.registration-step').forEach(s => s.classList.remove('active'));
        document.getElementById('step2').classList.add('active');
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
        document.querySelectorAll('.step').forEach((s, i) => {
            if (i === 0) s.classList.add('completed');
            if (i === 1) s.classList.add('active');
        });
        document.getElementById('progressFill').style.width = '66%';
    });
    
    // –®–∞–≥ 2 -> –®–∞–≥ 3
    document.getElementById('nextStep2')?.addEventListener('click', function(e) {
        e.preventDefault();
        
        const email = document.getElementById('email')?.value.trim();
        const password = document.getElementById('password')?.value;
        const confirmPassword = document.getElementById('confirmPassword')?.value;
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ email
        if (!email || !email.includes('@')) {
            document.getElementById('emailHint').textContent = '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email';
            document.getElementById('emailHint').className = 'form-hint error';
            return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
        if (!password || password.length < 6) {
            document.getElementById('passwordHint').textContent = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤';
            document.getElementById('passwordHint').className = 'form-hint error';
            return;
        }
        
        if (password !== confirmPassword) {
            document.getElementById('confirmPasswordHint').textContent = '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
            document.getElementById('confirmPasswordHint').className = 'form-hint error';
            return;
        }
        
        // –í—Å—ë —Ö–æ—Ä–æ—à–æ - –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —à–∞–≥ 3
        document.querySelectorAll('.registration-step').forEach(s => s.classList.remove('active'));
        document.getElementById('step3').classList.add('active');
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
        document.querySelectorAll('.step').forEach((s, i) => {
            if (i < 2) s.classList.add('completed');
            if (i === 2) s.classList.add('active');
        });
        document.getElementById('progressFill').style.width = '100%';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        const summary = document.getElementById('userDataSummary');
        if (summary) {
            summary.innerHTML = `
                <div>üë§ ${document.getElementById('firstName').value} ${document.getElementById('lastName').value}</div>
                <div>üìß ${email}</div>
                <div>üìÖ ${birthDay}.${birthMonth}.${birthYear}</div>
            `;
        }
    });
    
    // –ö–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
    document.getElementById('prevStep2')?.addEventListener('click', function() {
        document.querySelectorAll('.registration-step').forEach(s => s.classList.remove('active'));
        document.getElementById('step1').classList.add('active');
        
        document.querySelectorAll('.step').forEach((s, i) => {
            if (i === 0) s.classList.add('active');
            if (i > 0) s.classList.remove('active', 'completed');
        });
        document.getElementById('progressFill').style.width = '33%';
    });
    
    document.getElementById('prevStep3')?.addEventListener('click', function() {
        document.querySelectorAll('.registration-step').forEach(s => s.classList.remove('active'));
        document.getElementById('step2').classList.add('active');
        
        document.querySelectorAll('.step').forEach((s, i) => {
            if (i === 0) s.classList.add('completed');
            if (i === 1) s.classList.add('active');
            if (i === 2) s.classList.remove('active', 'completed');
        });
        document.getElementById('progressFill').style.width = '66%';
    });
    
    // –û—Ç–º–µ–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    document.getElementById('cancelRegistration')?.addEventListener('click', function() {
        if (confirm('–û—Ç–º–µ–Ω–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é?')) {
            location.reload();
        }
    });
    
    // –í–æ–∑–≤—Ä–∞—Ç —Å —ç–∫—Ä–∞–Ω–∞ –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
    document.getElementById('backFromAgeRestriction')?.addEventListener('click', function(e) {
        e.preventDefault();
        document.querySelectorAll('.form-container').forEach(f => f.classList.remove('active'));
        document.getElementById('registerForm').classList.add('active');
    });
    
    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ñ–æ—Ä–º–∞–º–∏
    document.getElementById('showLoginLink')?.addEventListener('click', function(e) {
        e.preventDefault();
        document.querySelectorAll('.form-container').forEach(f => f.classList.remove('active'));
        document.getElementById('loginForm').classList.add('active');
        document.getElementById('formTitle').textContent = '–í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç';
        document.getElementById('formSubtitle').textContent = '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ';
    });
    
    document.getElementById('showRegisterLink')?.addEventListener('click', function(e) {
        e.preventDefault();
        document.querySelectorAll('.form-container').forEach(f => f.classList.remove('active'));
        document.getElementById('registerForm').classList.add('active');
        document.getElementById('formTitle').textContent = '–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç';
        document.getElementById('formSubtitle').textContent = '–î–ª—è –≤—Ö–æ–¥–∞ –≤ –ú–µ—Ç—Ä–æ New';
    });
    
    // –ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å
    document.getElementById('forgotPasswordLink')?.addEventListener('click', function(e) {
        e.preventDefault();
        document.querySelectorAll('.form-container').forEach(f => f.classList.remove('active'));
        document.getElementById('resetPasswordForm').classList.add('active');
        document.getElementById('formTitle').textContent = '–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è';
        document.getElementById('formSubtitle').textContent = '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞';
    });
    
    document.getElementById('cancelResetBtn')?.addEventListener('click', function() {
        document.querySelectorAll('.form-container').forEach(f => f.classList.remove('active'));
        document.getElementById('loginForm').classList.add('active');
    });
}
</script>
    
</body>
</html>
