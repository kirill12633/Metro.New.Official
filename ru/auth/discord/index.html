<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discord –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è | –ú–µ—Ç—Ä–æ New</title>
    
    <!-- –ò–∫–æ–Ω–∫–∏ -->
    <link rel="shortcut icon" href="https://kirill12633.github.io/Metro.New.Official/ru/images/metro-icon.png" type="image/png">
    <link rel="apple-touch-icon" href="https://kirill12633.github.io/Metro.New.Official/ru/images/metro-icon.png">
    
    <!-- –®—Ä–∏—Ñ—Ç—ã –∏ –∏–∫–æ–Ω–∫–∏ -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- reCAPTCHA -->
    <script src="https://www.google.com/recaptcha/api.js?render=6LfgAZkrAAAAAOOU9svqDc-yVa23p4BRbEfElYJ-"></script>
    
    <!-- CSS —Ñ–∞–π–ª -->
    <link rel="stylesheet" href="ru/css/main.css">
    
    <!-- –í–ï–°–¨ HTML –ö–û–î –°–¢–†–ê–ù–ò–¶–´ –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò -->
    <div class="container">
        <div class="card">
            <div class="header">
                <div class="discord-logo">
                    <i class="fab fa-discord"></i>
                </div>
                <h1>Discord –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h1>
                <p>–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ –ú–µ—Ç—Ä–æ New</p>
            </div>
            
            <div class="content">
                <div class="status" id="statusSection">
                    <div class="status-icon" id="statusIcon">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <h3 id="statusTitle">–ù–∞—á–∞–ª–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h3>
                    <p id="statusText">–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Discord</p>
                    <div class="badge badge-primary" id="statusBadge">
                        <i class="fas fa-circle"></i> –ì–æ—Ç–æ–≤
                    </div>
                </div>
                
                <div class="notification" id="notification">
                    <i class="fas fa-exclamation-circle"></i>
                    <span id="notificationText"></span>
                </div>
                
                <div class="security-panel" id="securityPanel">
                    <div class="security-header">
                        <i class="fas fa-shield-alt"></i>
                        <div>
                            <h4 style="margin: 0; color: white;">–°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h4>
                            <p style="margin: 0; opacity: 0.8; font-size: 0.9rem;">–ó–∞—â–∏—Ç–∞ –æ—Ç –±–æ—Ç–æ–≤ –∏ –º–æ—à–µ–Ω–Ω–∏–∫–æ–≤</p>
                        </div>
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress" id="securityProgress"></div>
                    </div>
                    
                    <div class="security-metrics" id="securityMetrics"></div>
                </div>
                
                <div class="input-group" id="tokenSection">
                    <input type="text" class="token-input" id="tokenInput" 
                           placeholder="verify-discord-XXXXXXXXXX" 
                           pattern="verify-discord-[a-zA-Z0-9]{10}"
                           maxlength="25">
                    <button class="btn btn-primary" id="verifyTokenBtn">
                        <i class="fas fa-check"></i>
                        –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
                    </button>
                    <p class="note">–¢–æ–∫–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</p>
                </div>
                
                <div class="user-info" id="userInfoSection">
                    <h4><i class="fas fa-user-circle"></i> Discord –∞–∫–∫–∞—É–Ω—Ç</h4>
                    <div class="info-grid" id="userInfoGrid"></div>
                </div>
                
                <button class="btn btn-success" id="startAuthBtn">
                    <i class="fab fa-discord"></i>
                    –ù–∞—á–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ Discord
                </button>
                
                <button class="btn btn-warning" id="securityCheckBtn" style="display: none;">
                    <i class="fas fa-shield-alt"></i>
                    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
                </button>
                
                <button class="btn btn-outline" onclick="window.location.href='https://kirill12633.github.io/Metro.New.Official/'">
                    <i class="fas fa-home"></i>
                    –ù–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
                </button>
                
                <div class="loading" id="loadingSection">
                    <div class="spinner"></div>
                    <h3 id="loadingTitle">–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏...</h3>
                    <p id="loadingText">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ</p>
                </div>
            </div>
            
            <div class="footer">
                <p>¬© 2023 –ú–µ—Ç—Ä–æ New. –ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ Discord</p>
                <p style="font-size: 0.8rem; margin-top: 0.5rem;">
                    <i class="fas fa-shield-alt"></i> –ó–∞—â–∏—â–µ–Ω–æ Cloudflare Workers & reCAPTCHA v3
                </p>
            </div>
        </div>
    </div>
    
    <!-- –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê -->
    <div class="modal" id="errorModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h3>–û—à–∏–±–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h3>
                <p id="errorModalText">–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</p>
            </div>
            <div style="text-align: center; margin-top: 1.5rem;">
                <button class="btn btn-primary" onclick="hideModal('errorModal')">
                    <i class="fas fa-redo"></i>
                    –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                </button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="blockedModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-icon">
                    <i class="fas fa-ban"></i>
                </div>
                <h3>–î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω</h3>
                <p>–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</p>
            </div>
            <div style="text-align: center; margin-top: 1.5rem;">
                <p style="color: var(--gray); margin-bottom: 1rem;">
                    –î–æ—Å—Ç—É–ø –±—É–¥–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —á–µ—Ä–µ–∑: <strong id="blockTime">5 –º–∏–Ω—É—Ç</strong>
                </p>
                <button class="btn btn-outline" onclick="location.reload()">
                    <i class="fas fa-redo"></i>
                    –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
                </button>
            </div>
        </div>
    </div>

    <!-- –í–ï–°–¨ JAVASCRIPT –ö–û–î –î–õ–Ø –≠–¢–û–ô –°–¢–†–ê–ù–ò–¶–´ -->
    <script>
        // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
        const CONFIG = {
            WORKER_URL: 'https://metro-new-auth.kirilltyr123.workers.dev',
            RECAPTCHA_KEY: '6LfgAZkrAAAAAOOU9svqDc-yVa23p4BRbEfElYJ-',
            WEBHOOK_URL: 'https://discord.com/api/webhooks/1467223608089776159/zvnTCqZAEA7gCGvzs9o7AiAmS3WOcornH--mwIDVxWr7EI1L1Hj29blBjUiH27an6-tB',
            MAX_ATTEMPTS: 5,
            BLOCK_TIME: 5 * 60 * 1000,
            IP_API: 'https://api.ipify.org?format=json',
            SECURITY_THRESHOLD: 0.5
        };

        // –°–û–°–¢–û–Ø–ù–ò–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
        const state = {
            userIP: null,
            attempts: 0,
            isBlocked: false,
            blockEndTime: null,
            securityScore: 0,
            recaptchaToken: null,
            isLoading: false,
            mouseMovements: 0,
            reactionTime: null,
            currentToken: null,
            userData: null,
            isVerified: false,
            mouseMonitor: null,
            lastActivity: Date.now()
        };

        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã Discord –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...');
            
            try {
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
                await initState();
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
                checkBlockStatus();
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –∏–∑ URL
                checkUrlToken();
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
                initUI();
                
                // –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                startSecurityMonitoring();
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
                updateLastActivity();
                
                console.log('‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ');
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                showNotification('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã', 'error');
            }
        });

        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –°–û–°–¢–û–Ø–ù–ò–Ø
        async function initState() {
            // –ü–æ–ª—É—á–∞–µ–º IP
            state.userIP = await getClientIP();
            console.log('üåê IP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', state.userIP);
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
            state.attempts = parseInt(localStorage.getItem('discord_auth_attempts') || '0');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            const savedData = localStorage.getItem('discord_verification_data');
            if (savedData) {
                try {
                    state.userData = JSON.parse(savedData);
                    state.isVerified = true;
                    showUserInfo(state.userData);
                    updateStatus('verified', '–ê–∫–∫–∞—É–Ω—Ç –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω', 'badge-success');
                } catch (e) {
                    console.warn('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:', e);
                }
            }
        }

        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò–ù–¢–ï–†–§–ï–ô–°–ê
        function initUI() {
            // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
            window.elements = {
                statusSection: document.getElementById('statusSection'),
                statusIcon: document.getElementById('statusIcon'),
                statusTitle: document.getElementById('statusTitle'),
                statusText: document.getElementById('statusText'),
                statusBadge: document.getElementById('statusBadge'),
                tokenSection: document.getElementById('tokenSection'),
                tokenInput: document.getElementById('tokenInput'),
                verifyTokenBtn: document.getElementById('verifyTokenBtn'),
                userInfoSection: document.getElementById('userInfoSection'),
                userInfoGrid: document.getElementById('userInfoGrid'),
                startAuthBtn: document.getElementById('startAuthBtn'),
                securityCheckBtn: document.getElementById('securityCheckBtn'),
                securityPanel: document.getElementById('securityPanel'),
                securityProgress: document.getElementById('securityProgress'),
                securityMetrics: document.getElementById('securityMetrics'),
                loadingSection: document.getElementById('loadingSection'),
                loadingTitle: document.getElementById('loadingTitle'),
                loadingText: document.getElementById('loadingText'),
                notification: document.getElementById('notification'),
                notificationText: document.getElementById('notificationText')
            };

            // –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô
            elements.startAuthBtn.addEventListener('click', startDiscordAuth);
            elements.securityCheckBtn.addEventListener('click', runSecurityCheck);
            elements.verifyTokenBtn.addEventListener('click', verifyTokenHandler);
            elements.tokenInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') elements.verifyTokenBtn.click();
            });

            // –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º—ã—à–∏ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
            startMouseMonitoring();
        }

        // –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò

        // 1. –ù–ê–ß–ê–¢–¨ –ê–í–¢–û–†–ò–ó–ê–¶–ò–Æ DISCORD
        async function startDiscordAuth() {
            if (state.isBlocked) {
                showBlockedModal();
                return;
            }

            if (state.isLoading) return;

            try {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                await runSecurityCheck();
                
                // –ï—Å–ª–∏ security score –Ω–∏–∑–∫–∏–π, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
                if (state.securityScore < CONFIG.SECURITY_THRESHOLD) {
                    showModal('errorModal', '–ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
                    return;
                }

                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫
                state.attempts++;
                localStorage.setItem('discord_auth_attempts', state.attempts);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç –ø–æ–ø—ã—Ç–æ–∫
                if (state.attempts >= CONFIG.MAX_ATTEMPTS) {
                    blockUser('–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
                    return;
                }

                // –ü–æ–ª—É—á–∞–µ–º reCAPTCHA —Ç–æ–∫–µ–Ω
                showLoading('–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...');
                const recaptchaToken = await getRecaptchaToken('discord_auth');
                
                // –°–æ–∑–¥–∞–µ–º —Å–µ—Å—Å–∏—é
                const sessionId = generateSessionId();
                sessionStorage.setItem('auth_session_id', sessionId);
                sessionStorage.setItem('auth_timestamp', Date.now());
                sessionStorage.setItem('security_score', state.securityScore);

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ø—ã—Ç–∫—É
                await saveAuthAttempt({
                    sessionId,
                    ip: state.userIP,
                    securityScore: state.securityScore,
                    recaptchaToken,
                    timestamp: new Date().toISOString(),
                    action: 'discord_auth_start'
                });

                // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ Discord OAuth
                const authUrl = `${CONFIG.WORKER_URL}/login?` + new URLSearchParams({
                    session: sessionId,
                    ip: state.userIP,
                    recaptcha: recaptchaToken,
                    score: state.securityScore.toFixed(2),
                    ua: encodeURIComponent(navigator.userAgent)
                }).toString();

                showNotification('–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ Discord...', 'success');
                
                setTimeout(() => {
                    window.location.href = authUrl;
                }, 1000);

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
                showNotification('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ' + error.message, 'error');
                hideLoading();
            }
        }

        // 2. –ü–†–û–í–ï–†–ö–ê –¢–û–ö–ï–ù–ê –í–ï–†–ò–§–ò–ö–ê–¶–ò–ò
        async function verifyTokenHandler() {
            const token = elements.tokenInput.value.trim();
            
            if (!validateTokenFormat(token)) {
                showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ç–æ–∫–µ–Ω–∞! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: verify-discord-XXXXXXXXXX', 'error');
                return;
            }

            await verifyToken(token);
        }

        // 3. –ü–†–û–í–ï–†–ö–ê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò
        async function runSecurityCheck() {
            try {
                showLoading('–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏...');
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫
                state.securityScore = 0.5;
                state.mouseMovements = 0;
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è –º—ã—à–∏
                await analyzeMouseBehavior();
                updateSecurityMetric('mouse', '–ü–æ–≤–µ–¥–µ–Ω–∏–µ –º—ã—à–∏', state.mouseMovements > 10 ? '–•–æ—Ä–æ—à–æ' : '–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ');
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ —Ä–µ–∞–∫—Ü–∏–∏
                await testReactionTime();
                updateSecurityMetric('reaction', '–í—Ä–µ–º—è —Ä–µ–∞–∫—Ü–∏–∏', state.reactionTime ? `${state.reactionTime}–º—Å` : '–û—à–∏–±–∫–∞');
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ reCAPTCHA
                try {
                    const recaptchaToken = await getRecaptchaToken('security_check');
                    state.recaptchaToken = recaptchaToken;
                    updateSecurityMetric('recaptcha', 'reCAPTCHA v3', '‚úì –ü—Ä–æ–≤–µ—Ä–µ–Ω');
                    state.securityScore += 0.2;
                } catch (e) {
                    updateSecurityMetric('recaptcha', 'reCAPTCHA v3', '‚úó –û—à–∏–±–∫–∞');
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±—Ä–∞—É–∑–µ—Ä–∞
                checkBrowserFeatures();
                
                // –ò—Ç–æ–≥–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç
                calculateFinalSecurityScore();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                showSecurityPanel();
                
                // –ï—Å–ª–∏ score –≤—ã—Å–æ–∫–∏–π - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—Ö
                if (state.securityScore > 0.7) {
                    showNotification('‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–æ–π–¥–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!', 'success');
                }
                
                hideLoading();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏', 'error');
                hideLoading();
            }
        }

        // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò

        // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ —Ç–æ–∫–µ–Ω–∞
        function validateTokenFormat(token) {
            return token && token.match(/^verify-discord-[a-zA-Z0-9]{10}$/);
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –∏–∑ URL
        function checkUrlToken() {
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');
            
            if (token && validateTokenFormat(token)) {
                elements.tokenInput.value = token;
                setTimeout(() => verifyToken(token), 500);
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
        function checkBlockStatus() {
            const blockedUntil = localStorage.getItem('blocked_until');
            const blockReason = localStorage.getItem('block_reason');
            
            if (blockedUntil && Date.now() < parseInt(blockedUntil)) {
                state.isBlocked = true;
                state.blockEndTime = parseInt(blockedUntil);
                setTimeout(() => showBlockedModal(), 1000);
            } else {
                clearBlock();
            }
        }

        // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function blockUser(reason) {
            state.isBlocked = true;
            state.blockEndTime = Date.now() + CONFIG.BLOCK_TIME;
            
            localStorage.setItem('blocked_until', state.blockEndTime);
            localStorage.setItem('block_reason', reason);
            
            showBlockedModal();
            
            // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
            logSecurityEvent('USER_BLOCKED', {
                reason,
                ip: state.userIP,
                attempts: state.attempts,
                blockUntil: new Date(state.blockEndTime).toISOString()
            });
        }

        // –°–Ω—è—Ç–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
        function clearBlock() {
            state.isBlocked = false;
            state.blockEndTime = null;
            localStorage.removeItem('blocked_until');
            localStorage.removeItem('block_reason');
            
            // –°–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–∞ —á–µ—Ä–µ–∑ —á–∞—Å
            setTimeout(() => {
                state.attempts = 0;
                localStorage.removeItem('discord_auth_attempts');
            }, 60 * 60 * 1000);
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ reCAPTCHA —Ç–æ–∫–µ–Ω–∞
        async function getRecaptchaToken(action) {
            return new Promise((resolve, reject) => {
                grecaptcha.ready(async () => {
                    try {
                        const token = await grecaptcha.execute(CONFIG.RECAPTCHA_KEY, { action });
                        resolve(token);
                    } catch (error) {
                        reject(error);
                    }
                });
            });
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ID —Å–µ—Å—Å–∏–∏
        function generateSessionId() {
            const array = new Uint8Array(32);
            crypto.getRandomValues(array);
            return Array.from(array, byte => byte.toString(16).padStart(2, '0')).join('');
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ IP –∫–ª–∏–µ–Ω—Ç–∞
        async function getClientIP() {
            try {
                const response = await fetch(CONFIG.IP_API);
                const data = await response.json();
                return data.ip;
            } catch (error) {
                return 'unknown';
            }
        }

        // –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º—ã—à–∏
        function startMouseMonitoring() {
            let moveCount = 0;
            let lastMoveTime = Date.now();
            
            state.mouseMonitor = setInterval(() => {
                const now = Date.now();
                const timeDiff = now - lastMoveTime;
                
                if (timeDiff < 100) {
                    moveCount++;
                    if (moveCount > 5) {
                        state.securityScore += 0.01;
                    }
                }
                
                lastMoveTime = now;
                state.mouseMovements = moveCount;
            }, 1000);
        }

        // –ê–Ω–∞–ª–∏–∑ –ø–æ–≤–µ–¥–µ–Ω–∏—è –º—ã—à–∏
        async function analyzeMouseBehavior() {
            return new Promise((resolve) => {
                setTimeout(() => {
                    if (state.mouseMovements > 20) {
                        state.securityScore += 0.3;
                    } else if (state.mouseMovements > 10) {
                        state.securityScore += 0.2;
                    } else if (state.mouseMovements > 5) {
                        state.securityScore += 0.1;
                    }
                    resolve();
                }, 2000);
            });
        }

        // –¢–µ—Å—Ç –≤—Ä–µ–º–µ–Ω–∏ —Ä–µ–∞–∫—Ü–∏–∏
        async function testReactionTime() {
            return new Promise((resolve) => {
                const startTime = Date.now();
                const waitTime = 150 + Math.random() * 350;
                
                const testBtn = document.createElement('button');
                testBtn.textContent = '–ö–õ–ò–ö–ù–ò–¢–ï!';
                testBtn.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    padding: 1rem 2rem;
                    background: var(--primary);
                    color: white;
                    border: none;
                    border-radius: var(--radius-md);
                    cursor: pointer;
                    z-index: 3000;
                    font-weight: bold;
                    box-shadow: var(--shadow-lg);
                `;
                
                document.body.appendChild(testBtn);
                
                const clickHandler = () => {
                    const reactionTime = Date.now() - startTime - waitTime;
                    state.reactionTime = reactionTime;
                    
                    if (reactionTime > 100 && reactionTime < 500) {
                        state.securityScore += 0.3;
                    } else if (reactionTime >= 500 && reactionTime < 1000) {
                        state.securityScore += 0.2;
                    } else {
                        state.securityScore += 0.1;
                    }
                    
                    document.body.removeChild(testBtn);
                    resolve();
                };
                
                testBtn.addEventListener('click', clickHandler);
                
                setTimeout(() => {
                    if (testBtn.parentNode) {
                        document.body.removeChild(testBtn);
                        state.reactionTime = null;
                        resolve();
                    }
                }, 3000);
            });
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –±—Ä–∞—É–∑–µ—Ä–∞
        function checkBrowserFeatures() {
            const features = {
                cookies: navigator.cookieEnabled,
                javascript: true,
                localStorage: true,
                sessionStorage: true
            };
            
            let validFeatures = Object.values(features).filter(v => v).length;
            state.securityScore += (validFeatures / Object.keys(features).length) * 0.1;
        }

        // –†–∞—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤–æ–≥–æ security score
        function calculateFinalSecurityScore() {
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –æ—Ç 0 –¥–æ 1
            state.securityScore = Math.max(0, Math.min(1, state.securityScore));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
            elements.securityProgress.style.width = `${state.securityScore * 100}%`;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
        function updateSecurityMetric(id, label, value) {
            let html = '';
            
            const metrics = [
                { id: 'mouse', label: '–ü–æ–≤–µ–¥–µ–Ω–∏–µ –º—ã—à–∏', value: state.mouseMovements > 10 ? '–•–æ—Ä–æ—à–æ' : '–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ' },
                { id: 'reaction', label: '–í—Ä–µ–º—è —Ä–µ–∞–∫—Ü–∏–∏', value: state.reactionTime ? `${state.reactionTime}–º—Å` : '‚Äî' },
                { id: 'recaptcha', label: 'reCAPTCHA v3', value: state.recaptchaToken ? '‚úì –ü—Ä–æ–≤–µ—Ä–µ–Ω' : '‚úó –û—à–∏–±–∫–∞' },
                { id: 'score', label: 'Security Score', value: state.securityScore.toFixed(2) }
            ];
            
            metrics.forEach(metric => {
                html += `
                    <div class="metric">
                        <div class="metric-value">${metric.value}</div>
                        <div class="metric-label">${metric.label}</div>
                    </div>
                `;
            });
            
            elements.securityMetrics.innerHTML = html;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –ø–∞–Ω–µ–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
        function showSecurityPanel() {
            elements.securityPanel.style.display = 'block';
            elements.securityCheckBtn.style.display = 'inline-flex';
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
        function updateStatus(type, title, text, badgeClass = 'badge-primary') {
            const icons = {
                ready: 'fas fa-user-shield',
                loading: 'fas fa-spinner fa-spin',
                success: 'fas fa-check-circle',
                error: 'fas fa-times-circle',
                warning: 'fas fa-exclamation-triangle',
                verified: 'fas fa-user-check'
            };
            
            elements.statusIcon.className = 'status-icon animate';
            elements.statusIcon.innerHTML = `<i class="${icons[type] || icons.ready}"></i>`;
            elements.statusTitle.textContent = title;
            elements.statusText.textContent = text;
            elements.statusBadge.className = `badge ${badgeClass}`;
            elements.statusBadge.innerHTML = `<i class="${icons[type] || icons.ready}"></i> ${text}`;
            
            setTimeout(() => {
                elements.statusIcon.classList.remove('animate');
            }, 500);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        function showUserInfo(userData) {
            const formatDate = (timestamp) => {
                try {
                    return new Date(timestamp).toLocaleString('ru-RU');
                } catch {
                    return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                }
            };
            
            elements.userInfoGrid.innerHTML = `
                <div class="info-item">
                    <div class="info-label">Discord:</div>
                    <div class="info-value">${userData.username}#${userData.discriminator}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">ID:</div>
                    <div class="info-value" style="font-family: monospace; font-size: 0.9rem;">${userData.id}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Email:</div>
                    <div class="info-value">${userData.email || '–ù–µ —É–∫–∞–∑–∞–Ω'}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è:</div>
                    <div class="info-value">${userData.verified ? '‚úì –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω' : '‚úó –ù–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω'}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">IP:</div>
                    <div class="info-value" style="font-family: monospace; font-size: 0.9rem;">${userData.ip || state.userIP}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">–í—Ä–µ–º—è:</div>
                    <div class="info-value">${formatDate(userData.timestamp)}</div>
                </div>
            `;
            
            elements.userInfoSection.style.display = 'block';
            elements.tokenSection.style.display = 'none';
            
            updateStatus('verified', 'Discord –∞–∫–∫–∞—É–Ω—Ç –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω', '–ê–∫–∫–∞—É–Ω—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω', 'badge-success');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
            elements.securityCheckBtn.style.display = 'inline-flex';
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ —á–µ—Ä–µ–∑ Workers
        async function verifyToken(token) {
            try {
                showLoading('–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏...');
                
                const response = await fetch(`${CONFIG.WORKER_URL}/verify`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        token: token,
                        ip: state.userIP,
                        userAgent: navigator.userAgent,
                        timestamp: new Date().toISOString()
                    })
                });
                
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ç–æ–∫–µ–Ω–∞');
                }
                
                const data = await response.json();
                
                if (data.valid && data.user) {
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
                    state.userData = data.user;
                    state.isVerified = true;
                    state.currentToken = token;
                    
                    localStorage.setItem('discord_verification_data', JSON.stringify(data.user));
                    localStorage.setItem('discord_verification_token', token);
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                    showUserInfo(data.user);
                    
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º webhook
                    await sendVerificationWebhook(data.user);
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—Ö
                    showNotification('‚úÖ Discord –∞–∫–∫–∞—É–Ω—Ç —É—Å–ø–µ—à–Ω–æ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω!', 'success');
                    
                } else {
                    throw new Error(data.error || '–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–∞:', error);
                showNotification('‚ùå –û—à–∏–±–∫–∞: ' + error.message, 'error');
                updateStatus('error', '–û—à–∏–±–∫–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏', error.message, 'badge-danger');
            } finally {
                hideLoading();
            }
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        async function sendVerificationWebhook(userData) {
            try {
                const embed = {
                    title: '‚úÖ Discord –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è',
                    color: 0x43B581,
                    fields: [
                        { name: 'üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å', value: `${userData.username}#${userData.discriminator}`, inline: true },
                        { name: 'üÜî Discord ID', value: userData.id, inline: true },
                        { name: 'üìß Email', value: userData.email || '–ù–µ —É–∫–∞–∑–∞–Ω', inline: true },
                        { name: '‚úÖ –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è', value: userData.verified ? '–î–∞' : '–ù–µ—Ç', inline: true },
                        { name: 'üåê IP', value: state.userIP, inline: true },
                        { name: 'üîê Security Score', value: state.securityScore.toFixed(2), inline: true },
                        { name: 'üìÖ –í—Ä–µ–º—è', value: new Date().toLocaleString('ru-RU'), inline: false }
                    ],
                    footer: { text: '–ú–µ—Ç—Ä–æ New ‚Ä¢ –ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏' },
                    timestamp: new Date().toISOString()
                };
                
                await fetch(CONFIG.WEBHOOK_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ embeds: [embed] })
                });
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ webhook:', error);
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ø—ã—Ç–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        async function saveAuthAttempt(data) {
            try {
                const attempts = JSON.parse(localStorage.getItem('auth_attempts_history') || '[]');
                attempts.push({ ...data, timestamp: new Date().toISOString() });
                
                if (attempts.length > 50) {
                    attempts.shift();
                }
                
                localStorage.setItem('auth_attempts_history', JSON.stringify(attempts));
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ø—ã—Ç–∫–∏:', error);
            }
        }

        // –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
        function startSecurityMonitoring() {
            // –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π DOM
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'childList') {
                        mutation.addedNodes.forEach((node) => {
                            if (node.nodeType === 1) {
                                checkNodeSecurity(node);
                            }
                        });
                    }
                });
            });
            
            observer.observe(document.body, {
                childList: true,
                subtree: true
            });
            
            console.log('üîí –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∑–∞–ø—É—â–µ–Ω–∞');
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–∑–ª–æ–≤ –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
        function checkNodeSecurity(node) {
            if (node.tagName === 'SCRIPT') {
                const src = node.src || '';
                if (src.includes('malicious') || src.includes('hack')) {
                    node.remove();
                    logSecurityEvent('MALICIOUS_SCRIPT_BLOCKED', { src });
                    showNotification('‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω –∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç', 'error');
                }
            }
        }

        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
        function logSecurityEvent(type, data) {
            console.log(`[SECURITY] ${type}:`, data);
            
            const events = JSON.parse(localStorage.getItem('security_events') || '[]');
            events.push({
                type,
                timestamp: new Date().toISOString(),
                ip: state.userIP,
                ...data
            });
            
            if (events.length > 100) {
                events.shift();
            }
            
            localStorage.setItem('security_events', JSON.stringify(events));
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        function updateLastActivity() {
            state.lastActivity = Date.now();
            setTimeout(updateLastActivity, 30000);
        }

        // –£–¢–ò–õ–ò–¢–´ –ò–ù–¢–ï–†–§–ï–ô–°–ê

        function showLoading(title = '–ó–∞–≥—Ä—É–∑–∫–∞...', text = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ') {
            state.isLoading = true;
            elements.loadingTitle.textContent = title;
            elements.loadingText.textContent = text;
            elements.loadingSection.style.display = 'block';
            
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.btn').forEach(btn => {
                btn.disabled = true;
            });
        }

        function hideLoading() {
            state.isLoading = false;
            elements.loadingSection.style.display = 'none';
            
            // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.btn').forEach(btn => {
                btn.disabled = false;
            });
        }

        function showNotification(message, type = 'info') {
            elements.notificationText.textContent = message;
            elements.notification.className = `notification ${type}`;
            elements.notification.style.display = 'block';
            
            setTimeout(() => {
                elements.notification.style.display = 'none';
            }, 5000);
        }

        function showModal(modalId, text = '') {
            const modal = document.getElementById(modalId);
            if (text && modalId === 'errorModal') {
                document.getElementById('errorModalText').textContent = text;
            }
            modal.classList.add('show');
        }

        function hideModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        function showBlockedModal() {
            if (!state.isBlocked) return;
            
            const remaining = state.blockEndTime - Date.now();
            const minutes = Math.ceil(remaining / (60 * 1000));
            
            document.getElementById('blockTime').textContent = `${minutes} –º–∏–Ω—É—Ç`;
            showModal('blockedModal');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–π–º–µ—Ä
            updateBlockTimer();
        }

        function updateBlockTimer() {
            if (!state.isBlocked) return;
            
            const remaining = state.blockEndTime - Date.now();
            if (remaining <= 0) {
                clearBlock();
                hideModal('blockedModal');
                return;
            }
            
            const minutes = Math.ceil(remaining / (60 * 1000));
            document.getElementById('blockTime').textContent = `${minutes} –º–∏–Ω—É—Ç`;
            
            setTimeout(updateBlockTimer, 60000);
        }

        // –≠–ö–°–ü–û–†–¢ –§–£–ù–ö–¶–ò–ô –î–õ–Ø –û–¢–õ–ê–î–ö–ò
        window.discordAuthSystem = {
            getState: () => ({ ...state }),
            clearBlock,
            testSecurity: runSecurityCheck,
            getLogs: () => JSON.parse(localStorage.getItem('security_events') || '[]'),
            verifyToken: verifyTokenHandler,
            startAuth: startDiscordAuth
        };
    </script>
</body>
</html>
