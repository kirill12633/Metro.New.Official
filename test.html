<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metro –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 400px; 
            margin: 50px auto; 
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        input, button { 
            width: 100%; 
            padding: 12px; 
            margin: 8px 0; 
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .hidden { display: none; }
        .user-info { 
            background: #e9f7ef; 
            padding: 15px; 
            margin: 15px 0;
            border-radius: 5px;
            border-left: 4px solid #28a745;
        }
        .error { 
            color: #dc3545; 
            background: #f8d7da;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        h2 {
            color: #333;
            text-align: center;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
        <div id="auth-section">
            <h2>üîê –í—Ö–æ–¥ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h2>
            
            <div id="error-message" class="error hidden"></div>
            
            <input type="email" id="email" placeholder="üìß –í–∞—à email">
            <input type="password" id="password" placeholder="üîí –ü–∞—Ä–æ–ª—å">
            
            <button onclick="–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è()">üìù –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            <button onclick="–≤–æ–π—Ç–∏()">üö™ –í–æ–π—Ç–∏</button>
            <button onclick="–≤–æ–π—Ç–∏–ö–∞–∫–ì–æ—Å—Ç—å()">üë§ –í–æ–π—Ç–∏ –∫–∞–∫ –≥–æ—Å—Ç—å</button>
            
            <div style="text-align: center; margin-top: 15px; color: #666;">
                <small>–ò–ª–∏ –≤–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Google</small>
                <button onclick="–≤–æ–π—Ç–∏–ß–µ—Ä–µ–∑Google()" style="background: #db4437; margin-top: 5px;">
                    üîµ –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google
                </button>
            </div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö -->
        <div id="app-section" class="hidden">
            <h2>üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
            
            <div id="user-info" class="user-info"></div>
            
            <button onclick="–≤—ã–π—Ç–∏()" style="background: #6c757d;">üö™ –í—ã–π—Ç–∏</button>
            
            <!-- –í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–¥–µ—Å—å -->
            <div id="app-content" style="margin-top: 20px;">
                <h3>üöÄ –í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ!</h3>
                <p>–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≤–∞—à–µ–≥–æ Metro –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.</p>
                
                <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin-top: 15px;">
                    <h4>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ:</h4>
                    <div id="user-details"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth.js"></script>
    
    <script>
        // –í–∞—à–∏ –∫–ª—é—á–∏ Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDNAyhui3Lc_IX0wuot7_Z6Vdf9Bw5A9mE",
            authDomain: "metro-new-85226.firebaseapp.com",
            projectId: "metro-new-85226",
            storageBucket: "metro-new-85226.firebasestorage.app",
            messagingSenderId: "905640751733",
            appId: "1:905640751733:web:f1ab3a1b119ca1e245fe3c"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –æ—à–∏–±–æ–∫
        function –ø–æ–∫–∞–∑–∞—Ç—å–û—à–∏–±–∫—É(—Å–æ–æ–±—â–µ–Ω–∏–µ) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = —Å–æ–æ–±—â–µ–Ω–∏–µ;
            errorDiv.classList.remove('hidden');
            
            // –ê–≤—Ç–æ—Å–∫—Ä—ã—Ç–∏–µ –æ—à–∏–±–∫–∏ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                errorDiv.classList.add('hidden');
            }, 5000);
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–∫—Ä—ã—Ç–∏—è –æ—à–∏–±–æ–∫
        function —Å–∫—Ä—ã—Ç—å–û—à–∏–±–∫—É() {
            document.getElementById('error-message').classList.add('hidden');
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
        async function –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è() {
            —Å–∫—Ä—ã—Ç—å–û—à–∏–±–∫—É();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                –ø–æ–∫–∞–∑–∞—Ç—å–û—à–∏–±–∫—É('üìß –í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å');
                return;
            }
            
            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', userCredential.user);
                // –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ –ø–æ–∫–∞–∂–µ—Ç onAuthStateChanged
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:', error);
                
                // –†—É—Å—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
                if (error.code === 'auth/email-already-in-use') {
                    –ø–æ–∫–∞–∑–∞—Ç—å–û—à–∏–±–∫—É('‚ùå –≠—Ç–æ—Ç email —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è');
                } else if (error.code === 'auth/invalid-email') {
                    –ø–æ–∫–∞–∑–∞—Ç—å–û—à–∏–±–∫—É('‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email');
                } else if (error.code === 'auth/weak-password') {
                    –ø–æ–∫–∞–∑–∞—Ç—å–û—à–∏–±–∫—É('‚ùå –ü–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º –ø—Ä–æ—Å—Ç–æ–π (–º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤)');
                } else {
                    –ø–æ–∫–∞–∑–∞—Ç—å–û—à–∏–±–∫—É('‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ' + error.message);
                }
            }
        }

        // –í—Ö–æ–¥
        async function –≤–æ–π—Ç–∏() {
            —Å–∫—Ä—ã—Ç—å–û—à–∏–±–∫—É();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                –ø–æ–∫–∞–∑–∞—Ç—å–û—à–∏–±–∫—É('üìß –í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å');
                return;
            }
            
            try {
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ—à–µ–ª:', userCredential.user);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:', error);
                
                // –†—É—Å—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
                if (error.code === 'auth/user-not-found') {
                    –ø–æ–∫–∞–∑–∞—Ç—å–û—à–∏–±–∫—É('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
                } else if (error.code === 'auth/wrong-password') {
                    –ø–æ–∫–∞–∑–∞—Ç—å–û—à–∏–±–∫—É('‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å');
                } else if (error.code === 'auth/invalid-email') {
                    –ø–æ–∫–∞–∑–∞—Ç—å–û—à–∏–±–∫—É('‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email');
                } else {
                    –ø–æ–∫–∞–∑–∞—Ç—å–û—à–∏–±–∫—É('‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + error.message);
                }
            }
        }

        // –í—Ö–æ–¥ –∫–∞–∫ –≥–æ—Å—Ç—å
        async function –≤–æ–π—Ç–∏–ö–∞–∫–ì–æ—Å—Ç—å() {
            —Å–∫—Ä—ã—Ç—å–û—à–∏–±–∫—É();
            try {
                const userCredential = await auth.signInAnonymously();
                console.log('–ì–æ—Å—Ç—å –≤–æ—à–µ–ª:', userCredential.user);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≥–æ—Å—Ç–µ–≤–æ–≥–æ –≤—Ö–æ–¥–∞:', error);
                –ø–æ–∫–∞–∑–∞—Ç—å–û—à–∏–±–∫—É('‚ùå –û—à–∏–±–∫–∞ –≥–æ—Å—Ç–µ–≤–æ–≥–æ –≤—Ö–æ–¥–∞');
            }
        }

        // –í—Ö–æ–¥ —á–µ—Ä–µ–∑ Google
        async function –≤–æ–π—Ç–∏–ß–µ—Ä–µ–∑Google() {
            —Å–∫—Ä—ã—Ç—å–û—à–∏–±–∫—É();
            // –ù—É–∂–Ω–æ —Å–Ω–∞—á–∞–ª–∞ –≤–∫–ª—é—á–∏—Ç—å Google –ø—Ä–æ–≤–∞–π–¥–µ—Ä –≤ Firebase Console
            –ø–æ–∫–∞–∑–∞—Ç—å–û—à–∏–±–∫—É('‚ö†Ô∏è Google –≤—Ö–æ–¥ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ Firebase Console');
            
            // –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∫–æ–≥–¥–∞ –Ω–∞—Å—Ç—Ä–æ–∏—Ç–µ Google –ø—Ä–æ–≤–∞–π–¥–µ—Ä:
            /*
            const provider = new firebase.auth.GoogleAuthProvider();
            try {
                const result = await auth.signInWithPopup(provider);
                console.log('Google –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', result.user);
            } catch (error) {
                –ø–æ–∫–∞–∑–∞—Ç—å–û—à–∏–±–∫—É('‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ Google');
            }
            */
        }

        // –í—ã—Ö–æ–¥
        async function –≤—ã–π—Ç–∏() {
            try {
                await auth.signOut();
                console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—à–µ–ª');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞:', error);
                –ø–æ–∫–∞–∑–∞—Ç—å–û—à–∏–±–∫—É('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ');
            }
        }

        // –°–ª–µ–¥–∏–º –∑–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
        auth.onAuthStateChanged((user) => {
            const authSection = document.getElementById('auth-section');
            const appSection = document.getElementById('app-section');
            const userInfo = document.getElementById('user-info');
            const userDetails = document.getElementById('user-details');
            
            if (user) {
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ—à–µ–ª
                authSection.classList.add('hidden');
                appSection.classList.remove('hidden');
                
                const isAnonymous = user.isAnonymous;
                const email = user.email;
                
                userInfo.innerHTML = `
                    <strong>üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> ${email || '–ì–æ—Å—Ç—å'}<br>
                    <strong>üÜî UID:</strong> ${user.uid}<br>
                    <strong>üéØ –¢–∏–ø:</strong> ${isAnonymous ? '–ì–æ—Å—Ç—å' : '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π'}<br>
                    <strong>üìÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:</strong> ${new Date(user.metadata.creationTime).toLocaleDateString('ru-RU')}
                `;
                
                userDetails.innerHTML = `
                    <p><strong>Email:</strong> ${email || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
                    <p><strong>Email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω:</strong> ${user.emailVerified ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}</p>
                    <p><strong>–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥:</strong> ${new Date(user.metadata.lastSignInTime).toLocaleString('ru-RU')}</p>
                    <p><strong>–ê–Ω–æ–Ω–∏–º–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç:</strong> ${isAnonymous ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}</p>
                `;
                
                // –û—á–∏—â–∞–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞
                document.getElementById('email').value = '';
                document.getElementById('password').value = '';
                —Å–∫—Ä—ã—Ç—å–û—à–∏–±–∫—É();
                
            } else {
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—à–µ–ª
                authSection.classList.remove('hidden');
                appSection.classList.add('hidden');
            }
        });

        // Enter –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤—Ö–æ–¥–∞
        document.getElementById('password').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                –≤–æ–π—Ç–∏();
            }
        });
    </script>
</body>
</html>
