<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metro Security Docs | –ü—Ä–æ—Å–º–æ—Ç—Ä</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/viewer.css">
    <link rel="icon" href="assets/logo.png">
</head>
<body>
    <div class="viewer-container">
        <!-- Top Bar -->
        <header class="viewer-header">
            <div class="header-left">
                <button onclick="goBack()" class="btn-back">‚Üê –ù–∞–∑–∞–¥</button>
                <h2 id="documentTitle">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞...</h2>
            </div>
            <div class="header-right">
                <div class="user-info-small">
                    <span id="viewerUser">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
                    <button onclick="logout()" class="btn-logout-small">–í—ã–π—Ç–∏</button>
                </div>
                <div class="session-timer">
                    <span>–°–µ—Å—Å–∏—è: </span>
                    <span id="sessionTimer">29:59</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="viewer-main">
            <!-- Sidebar with documents list -->
            <aside class="documents-sidebar">
                <div class="sidebar-search">
                    <input type="text" placeholder="–ü–æ–∏—Å–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤..." id="docSearch">
                    <button class="btn-search">üîç</button>
                </div>
                
                <div class="categories">
                    <h4>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h4>
                    <button class="category-btn active">–í—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã</button>
                    <button class="category-btn">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ</button>
                    <button class="category-btn">–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ</button>
                    <button class="category-btn">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</button>
                    <button class="category-btn">–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ</button>
                </div>

                <div class="documents-list" id="documentsList">
                    <!-- –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                </div>
            </aside>

            <!-- Document Viewer -->
            <main class="document-viewer">
                <div class="viewer-toolbar">
                    <button class="tool-btn" onclick="zoomIn()">+</button>
                    <button class="tool-btn" onclick="zoomOut()">-</button>
                    <button class="tool-btn" onclick="rotateDoc()">‚Üª</button>
                    <button class="tool-btn" onclick="printDoc()" id="printBtn">üñ®Ô∏è</button>
                    <button class="tool-btn" onclick="downloadDoc()" id="downloadBtn">‚¨áÔ∏è</button>
                    <span class="tool-separator">|</span>
                    <span>–ú–∞—Å—à—Ç–∞–±: <span id="zoomLevel">100%</span></span>
                    <span class="watermark-status">–í–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫: <span id="watermarkStatus">–∞–∫—Ç–∏–≤–µ–Ω</span></span>
                </div>

                <div class="viewer-content">
                    <!-- PDF Viewer -->
                    <div id="pdfViewer" class="viewer-area">
                        <canvas id="pdfCanvas"></canvas>
                        <div class="watermark-overlay" id="watermarkOverlay"></div>
                    </div>

                    <!-- Image Viewer -->
                    <div id="imageViewer" class="viewer-area" style="display:none;">
                        <img id="imageDisplay" src="" alt="Document Image">
                        <div class="watermark-overlay" id="imageWatermark"></div>
                    </div>

                    <!-- Unsupported format -->
                    <div id="unsupportedViewer" class="viewer-area" style="display:none;">
                        <div class="unsupported-message">
                            <h3>–§–æ—Ä–º–∞—Ç –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</h3>
                            <p>–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Å –≤–æ–¥—è–Ω—ã–º–∏ –∑–Ω–∞–∫–∞–º–∏</p>
                            <button onclick="forceDownload()" class="btn-download">–°–∫–∞—á–∞—Ç—å —Å –≤–æ–¥—è–Ω—ã–º –∑–Ω–∞–∫–æ–º</button>
                        </div>
                    </div>
                </div>

                <div class="document-info">
                    <h4>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ–∫—É–º–µ–Ω—Ç–µ</h4>
                    <table>
                        <tr>
                            <td>–ù–∞–∑–≤–∞–Ω–∏–µ:</td>
                            <td id="infoTitle">-</td>
                        </tr>
                        <tr>
                            <td>–¢–∏–ø:</td>
                            <td id="infoType">-</td>
                        </tr>
                        <tr>
                            <td>–†–∞–∑–º–µ—Ä:</td>
                            <td id="infoSize">-</td>
                        </tr>
                        <tr>
                            <td>–î–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏:</td>
                            <td id="infoDate">-</td>
                        </tr>
                        <tr>
                            <td>–£—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø–∞:</td>
                            <td id="infoAccess">-</td>
                        </tr>
                        <tr>
                            <td>–ü–æ—Å–ª–µ–¥–Ω–∏–π –ø—Ä–æ—Å–º–æ—Ç—Ä:</td>
                            <td id="infoLastView">-</td>
                        </td>
                    </table>
                </div>
            </main>
        </div>

        <!-- Security Warning -->
        <div class="security-warning">
            <p>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ! –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è –∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º—É –∞—É–¥–∏—Ç–∞. 
               –ó–∞–ø—Ä–µ—â–µ–Ω–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø–µ—á–∞—Ç—å –∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.</p>
        </div>
    </div>

    <script src="js/firebase-config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/viewer.js"></script>
    <script src="js/watermark.js"></script>
    <script src="js/security.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            checkViewerAccess();
            loadDocuments();
            startSessionTimer();
        });
    </script>
</body>
</html>
