<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Metro Login Test</title>
    <style>
        body {
            font-family: Arial;
            max-width: 400px;
            margin: 50px auto;
            padding: 20px;
        }
        .login-box {
            border: 1px solid #ccc;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            width: 100%;
            padding: 12px;
            background: #2c3e50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #3498db;
        }
        .message {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="login-box">
        <h2>üöá Metro Security - –¢–µ—Å—Ç –≤—Ö–æ–¥–∞</h2>
        
        <div id="status">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        
        <input type="email" id="email" placeholder="Email" value="test@example.com">
        <input type="password" id="password" placeholder="Password" value="test123">
        
        <button onclick="login()">–í–æ–π—Ç–∏</button>
        
        <div id="result" class="message"></div>
        
        <div style="margin-top: 20px; font-size: 12px; color: #666;">
            <p><strong>–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:</strong> test@example.com / test123</p>
            <p><strong>–ü—Ä–æ–µ–∫—Ç:</strong> metro-new-85226</p>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Firebase 8 (—Å–∞–º–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

    <script>
        // ==================== –í–ê–®–ê –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ====================
        const firebaseConfig = {
            apiKey: "AIzaSyDNAyhui3Lc_IX0wuot7_Z6Vdf9Bw5A9mE",
            authDomain: "metro-new-85226.firebaseapp.com",
            projectId: "metro-new-85226",
            storageBucket: "metro-new-85226.firebasestorage.app",
            messagingSenderId: "905640751733",
            appId: "1:905640751733:web:f1ab3a1b119ca1e245fe3c"
        };

        console.log("üî• –ù–∞—á–∏–Ω–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é...");

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        try {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Firebase
            firebase.initializeApp(firebaseConfig);
            console.log("‚úÖ Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!");
            document.getElementById('status').innerHTML = 
                '<span style="color:green">‚úÖ Firebase –ø–æ–¥–∫–ª—é—á–µ–Ω</span>';
        } catch (error) {
            console.error("‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:", error);
            document.getElementById('status').innerHTML = 
                `<span style="color:red">‚ùå –û—à–∏–±–∫–∞: ${error.message}</span>`;
        }

        // –ü–æ–ª—É—á–∞–µ–º auth –æ–±—ä–µ–∫—Ç
        const auth = firebase.auth();

        // ==================== –§–£–ù–ö–¶–ò–Ø –í–•–û–î–ê ====================
        async function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const resultDiv = document.getElementById('result');
            
            resultDiv.innerHTML = "–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Ö–æ–¥...";
            resultDiv.className = "message";
            
            console.log("üîÑ –ü—ã—Ç–∞–µ–º—Å—è –≤–æ–π—Ç–∏ —Å:", email);
            
            try {
                // –ü—Ä–æ–±—É–µ–º –≤–æ–π—Ç–∏
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                console.log("‚úÖ –£–°–ü–ï–•! –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:", user.uid);
                
                resultDiv.innerHTML = `
                    <span style="color:green">
                    ‚úÖ –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω!<br>
                    Email: ${user.email}<br>
                    ID: ${user.uid}<br>
                    –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã...
                    </span>
                `;
                resultDiv.className = "message success";
                
                // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    window.location.href = 'viewer.html';
                }, 2000);
                
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:", error.code, error.message);
                
                let errorMessage = "–û—à–∏–±–∫–∞: ";
                switch(error.code) {
                    case 'auth/user-not-found':
                        errorMessage = "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω. –°–æ–∑–¥–∞–π—Ç–µ –µ–≥–æ –≤ Firebase Console";
                        break;
                    case 'auth/wrong-password':
                        errorMessage = "–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å";
                        break;
                    case 'auth/invalid-email':
                        errorMessage = "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email";
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = "–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ";
                        break;
                    default:
                        errorMessage = error.message;
                }
                
                resultDiv.innerHTML = `<span style="color:red">‚ùå ${errorMessage}</span>`;
                resultDiv.className = "message error";
            }
        }

        // ==================== –ü–†–û–í–ï–†–ö–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò ====================
        auth.onAuthStateChanged((user) => {
            console.log("üìä –°–æ—Å—Ç–æ—è–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:", user ? "–ï—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å" : "–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è");
            
            if (user) {
                console.log("‚ÑπÔ∏è –£–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∫–∞–∫:", user.email);
                document.getElementById('status').innerHTML = 
                    `<span style="color:green">‚úÖ –£–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω: ${user.email}</span>`;
                
                // –ï—Å–ª–∏ —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –ø–µ—Ä–µ–π—Ç–∏
                setTimeout(() => {
                    if (confirm("–í—ã —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã. –ü–µ—Ä–µ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É?")) {
                        window.location.href = 'viewer.html';
                    }
                }, 1000);
            }
        });

        // ==================== –¢–ï–°–¢ –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø ====================
        console.log("üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é...");
        console.log("Project ID:", firebaseConfig.projectId);
        console.log("API Key:", firebaseConfig.apiKey ? "–ï—Å—Ç—å" : "–ù–µ—Ç");
        
        // –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
        setTimeout(() => {
            const user = auth.currentUser;
            if (user) {
                console.log("‚úÖ –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:", user.email);
            } else {
                console.log("‚ÑπÔ∏è –ù–µ—Ç —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è");
            }
        }, 3000);
    </script>
</body>
</html>
