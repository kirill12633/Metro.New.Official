<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Профиль - Метро New</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../../assets/css/style.css">
</head>
<body>
    <nav class="nav">
        <div class="container nav-container">
            <div class="logo">
                <span class="logo-icon">M</span>
                <span>Метро New</span>
            </div>
            <div class="nav-links">
                <a href="../../../index.html">Главная</a>
                <a href="../../../game.html">Игра</a>
                <a href="settings.html">Настройки</a>
                <a href="#" id="logoutBtn">Выйти</a>
                <div class="user-info d-flex align-center gap-2">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <span class="user-name" id="userName">Пользователь</span>
                </div>
            </div>
        </div>
    </nav>

    <main>
        <div class="container" style="padding: 2rem 0;">
            <div class="metro-background"></div>
            
            <div class="profile-header animate-fade-in-up">
                <div class="card text-center">
                    <div id="profileAvatar" class="profile-avatar">U</div>
                    <h1 id="profileName">Пользователь</h1>
                    <p class="text-muted" id="profileEmail">user@example.com</p>
                    
                    <div class="profile-stats">
                        <div class="stat-card">
                            <div class="stat-number" id="gamesPlayed">0</div>
                            <div class="stat-label">Игр сыграно</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalScore">0</div>
                            <div class="stat-label">Общий счет</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="userLevel">1</div>
                            <div class="stat-label">Уровень</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-2 gap-3">
                <div class="card">
                    <h3><i class="fas fa-user-edit"></i> Редактировать профиль</h3>
                    <div class="form-group">
                        <label class="form-label">Имя пользователя</label>
                        <input type="text" class="form-input" id="displayName" placeholder="Введите имя">
                    </div>
                    <button class="btn btn-primary" onclick="updateProfile()">
                        <i class="fas fa-save"></i> Сохранить
                    </button>
                </div>

                <div class="card">
                    <h3><i class="fas fa-shield-alt"></i> Безопасность</h3>
                    <p>Email: <span id="userEmail"></span></p>
                    <button class="btn btn-outline w-100 mb-2" onclick="changePassword()">
                        <i class="fas fa-key"></i> Сменить пароль
                    </button>
                    <button class="btn btn-outline w-100" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Выйти
                    </button>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Проверяем авторизацию
        const userData = JSON.parse(localStorage.getItem('metro_user'));
        
        if (!userData) {
            window.location.href = 'login.html';
        } else {
            // Загружаем данные пользователя
            document.getElementById('profileName').textContent = userData.displayName || userData.email;
            document.getElementById('profileEmail').textContent = userData.email;
            document.getElementById('userEmail').textContent = userData.email;
            document.getElementById('userName').textContent = userData.displayName || userData.email;
            document.getElementById('userAvatar').textContent = (userData.displayName || userData.email).charAt(0).toUpperCase();
            document.getElementById('profileAvatar').textContent = (userData.displayName || userData.email).charAt(0).toUpperCase();
            document.getElementById('displayName').value = userData.displayName || '';
            
            // Загружаем статистику
            if (userData.stats) {
                document.getElementById('gamesPlayed').textContent = userData.stats.gamesPlayed || 0;
                document.getElementById('totalScore').textContent = userData.stats.totalScore || 0;
                document.getElementById('userLevel').textContent = userData.stats.level || 1;
            }
        }

        function updateProfile() {
            const displayName = document.getElementById('displayName').value;
            if (displayName) {
                userData.displayName = displayName;
                localStorage.setItem('metro_user', JSON.stringify(userData));
                
                document.getElementById('profileName').textContent = displayName;
                document.getElementById('userName').textContent = displayName;
                document.getElementById('userAvatar').textContent = displayName.charAt(0).toUpperCase();
                document.getElementById('profileAvatar').textContent = displayName.charAt(0).toUpperCase();
                
                alert('Профиль обновлен!');
            }
        }

        function changePassword() {
            alert('Функция смены пароля будет доступна в следующем обновлении');
        }

        function logout() {
            localStorage.removeItem('metro_user');
            window.location.href = 'login.html';
        }

        // Обработчик кнопки выхода в навигации
        document.getElementById('logoutBtn').addEventListener('click', function(e) {
            e.preventDefault();
            logout();
        });
    </script>
</body>
</html>
