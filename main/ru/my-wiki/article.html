<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—Ç–∞—Ç—å—è - –ú–æ—è –í–∏–∫–∏</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>üìñ –ú–æ—è –í–∏–∫–∏</h1>
        <nav>
            <a href="index.html">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
            <a href="#" id="edit-link">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
        </nav>
    </header>
    
    <main>
        <article>
            <h1 id="article-title">–ó–∞–≥—Ä—É–∑–∫–∞...</h1>
            <div id="article-content">
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ...</p>
            </div>
        </article>
        
        <div id="article-meta">
            <!-- –ú–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
        </div>
    </main>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∫—Ä–∏–ø—Ç—ã -->
    <script type="module">
        // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase (–ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –°–í–û–Æ!)
        const firebaseConfig = {
            apiKey: "AIzaSyDNAyhui3Lc_IX0wuot7_Z6Vdf9Bw5A9mE",
            authDomain: "https://metro-new-85226-default-rtdb.firebaseio.com",
            projectId: "metro-new-85226",
            storageBucket: "metro-new-85226.firebasestorage.app",
            messagingSenderId: "905640751733",
            appId: "1:905640751733:web:f1ab3a1b119ca1e245fe3c"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // –ü–æ–ª—É—á–∞–µ–º pageName –∏–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        const urlParams = new URLSearchParams(window.location.search);
        const pageId = urlParams.get('page');

        const articleTitle = document.getElementById('article-title');
        const articleContent = document.getElementById('article-content');
        const articleMeta = document.getElementById('article-meta');
        const editLink = document.getElementById('edit-link');

        async function loadArticle() {
            if (!pageId) {
                showError("–°—Ç–∞—Ç—å—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞", "–ù–µ —É–∫–∞–∑–∞–Ω –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã.");
                return;
            }

            try {
                const docRef = doc(db, "pages", pageId);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const pageData = docSnap.data();
                    
                    // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
                    articleTitle.textContent = pageData.pageName || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
                    articleContent.innerHTML = pageData.content || '<p>–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.</p>';
                    
                    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É
                    const timestamp = pageData.timestamp?.toDate 
                        ? new Date(pageData.timestamp.toDate()).toLocaleString('ru-RU')
                        : '–î–∞—Ç–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞';
                    
                    // –ó–∞–ø–æ–ª–Ω—è–µ–º –º–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                    articleMeta.innerHTML = `
                        <hr>
                        <div class="meta-info">
                            <p><strong>–°–æ–∑–¥–∞–Ω–æ:</strong> ${pageData.createdBy || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</p>
                            <p><strong>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª:</strong> ${pageData.editedBy || pageData.createdBy || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</p>
                            <p><strong>–û–±–Ω–æ–≤–ª–µ–Ω–æ:</strong> ${timestamp}</p>
                            ${pageData.ip ? `<p><strong>IP:</strong> ${pageData.ip}</p>` : ''}
                        </div>
                    `;
                    
                    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å—Å—ã–ª–∫—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                    if (editLink) {
                        editLink.href = `edit.html?page=${pageId}`;
                    }
                    
                } else {
                    showError("–°—Ç–∞—Ç—å—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞", `–°—Ç–∞—Ç—å—è —Å ID "${pageId}" –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. <a href="edit.html?page=${pageId}">–°–æ–∑–¥–∞—Ç—å —ç—Ç—É —Å—Ç–∞—Ç—å—é?</a>`);
                }
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç—å–∏:", error);
                showError("–û—à–∏–±–∫–∞", "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç–∞—Ç—å–∏.");
            }
        }

        function showError(title, message) {
            if (articleTitle) articleTitle.textContent = title;
            if (articleContent) articleContent.innerHTML = `<p>${message}</p>`;
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç—å—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', loadArticle);
    </script>
</body>
</html>
