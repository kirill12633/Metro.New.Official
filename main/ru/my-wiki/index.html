<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –í–∏–∫–∏ - –ì–ª–∞–≤–Ω–∞—è</title>
    <style>
        body { font-family: Arial; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
        header { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        nav a { margin-right: 15px; text-decoration: none; color: #0066cc; padding: 5px 10px; border-radius: 4px; }
        .article-card { background: white; padding: 15px; margin: 10px 0; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); border-left: 4px solid #0066cc; }
        .create-btn { display: inline-block; background: #4CAF50; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; margin: 20px 0; }
    </style>
</head>
<body>
    <header>
        <h1>üîí –ó–∞—â–∏—â–µ–Ω–Ω–∞—è –í–∏–∫–∏</h1>
        <nav>
            <a href="index.html" style="background: #e3f2fd;">üè† –ì–ª–∞–≤–Ω–∞—è</a>
            <a href="edit.html">üìù –°–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ç—å—é</a>
            <a href="wiki.html">‚ÑπÔ∏è –û –≤–∏–∫–∏</a>
        </nav>
    </header>

    <main>
        <a href="edit.html" class="create-btn">+ –°–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ç—å—é</a>
        <div id="articles-list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, orderBy, query } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { initializeAppCheck, ReCaptchaV3Provider } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app-check.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDNAyhui3Lc_IX0wuot7_Z6Vdf9Bw5A9mE",
            authDomain: "metro-new-85226.firebaseapp.com",
            projectId: "metro-new-85226",
            storageBucket: "metro-new-85226.firebasestorage.app",
            messagingSenderId: "905640751733",
            appId: "1:905640751733:web:f1ab3a1b119ca1e245fe3c"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è App Check (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à reCAPTCHA –∫–ª—é—á)
        const appCheck = initializeAppCheck(app, {
            provider: new ReCaptchaV3Provider('6LcBcSgqAAAAAFhVSEwZaM8j6cY3N0MqJ3e6O6t7'), // –ü—Ä–∏–º–µ—Ä –∫–ª—é—á–∞
            isTokenAutoRefreshEnabled: true
        });

        async function loadArticles() {
            const articlesList = document.getElementById('articles-list');
            
            try {
                console.log("–ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç—å–∏ —Å App Check...");
                const q = query(collection(db, "pages"), orderBy("timestamp", "desc"));
                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    articlesList.innerHTML = '<p>üìù –°—Ç–∞—Ç–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</p>';
                    return;
                }

                articlesList.innerHTML = '';
                querySnapshot.forEach((doc) => {
                    const article = doc.data();
                    const articleCard = document.createElement('div');
                    articleCard.className = 'article-card';
                    articleCard.innerHTML = `
                        <h3><a href="article.html?page=${doc.id}">${article.pageName || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</a></h3>
                        <p><strong>–ê–≤—Ç–æ—Ä:</strong> ${article.createdBy || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</p>
                    `;
                    articlesList.appendChild(articleCard);
                });

            } catch (error) {
                console.error("–û—à–∏–±–∫–∞:", error);
                articlesList.innerHTML = `<p style="color: red;">‚ùå –û—à–∏–±–∫–∞: ${error.message}</p>`;
            }
        }

        document.addEventListener('DOMContentLoaded', loadArticles);
    </script>
</body>
</html>
